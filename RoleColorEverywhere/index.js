(function(M,p,y,h,b,R,s,L,g,G,I){"use strict";const{Text:$}=b.General,k=h.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:U}}=h.findByProps("colors","meta"),V=h.findByStoreName("UserStore"),j=h.findByStoreName("RelationshipStore"),F=h.findByStoreName("GuildMemberStore"),O=h.findByProps("TYPING_WRAPPER_HEIGHT");function H(){return y.after("default",O,function(e,t){let[{channel:o}]=e;if(!t||s.storage.hideTyping)return;const i=t.props?.children,l=U(k.theme,R.semanticColors.HEADER_SECONDARY),d=y.after("type",i,function(f,u){p.React.useEffect(function(){return function(){d()}},[]);const r=u?.props?.children?.[0]?.props?.children?.[1]?.props;if(!r||!r.children||r.children==="Several people are typing...")return;const n=O.useTypingUserIds(o.id).map(function(a){const c=F.getMember(o.guild_id,a),N=V.getUser(a),_=c?.nick||j.getNickname(a)||N.globalName||N.username,A=c?.colorString||l;return{displayName:_,displayColor:A}});function m(a){return p.React.createElement($,{style:{color:a.displayColor,fontFamily:p.constants.Fonts.DISPLAY_BOLD}},a.displayName)}!n||n.length<1||(r.children=n.length===1?[m(n[0])," is typing..."]:[...n.slice(0,n.length-1).flatMap(function(a,c){return[m(a),c<n.length-2?", ":" and "]}),m(n[n.length-1])," are typing..."])})})}const Y=h.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:W}}=h.findByProps("colors","meta"),K=h.findByName("RowManager"),P=h.findByStoreName("GuildMemberStore"),X=h.findByStoreName("ChannelStore");function S(e,t,o,i){if(e)return i=Object.assign([],i),i?i.push(e):i=[e],Array.isArray(e.content)?e.content.forEach(function(l,d){return e.content[d]=S(l,t,o,i)}):e.items?e.items.forEach(function(l,d){return e.items[d]=S(l,t,o,i)}):Array.isArray(e)&&e.forEach(function(l,d){return e[d]=S(l,t,o,i)}),e.type&&t.forEach(function(l){e=l(e,o,i)||e}),e}function z(e,t,o){const i=function(r){return r.match(/\w\w/g).map(function(n){return parseInt(n,16)})},l=function(r){return"#"+r.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},d=i(e),f=i(t),u=d.map(function(r,n){return Math.round(r+(f[n]-r)*o)});return l(u)}function D(e){const{message:t}=e;if(!t||(!s.storage.chatInterpolation||s.storage.chatInterpolation<=0)&&s.storage.noMention)return;const o=X.getChannel(t.channelId);if(!o?.guild_id)return;const i=function(u){if(u.type!="mention"||!u.userId)return;const r=P.getMember(o.guild_id,u.userId)?.colorString;if(!r)return;const n=parseInt(r.slice(1),16);return{...u,roleColor:n,color:n,colorString:r}},l=W(Y.theme,R.semanticColors.TEXT_NORMAL),d=function(u,r,n){let[m]=r,a=n?.map(function(N){return N.type});if(a?.includes("mention")||a?.includes("channelMention")||a?.includes("roleMention")||a?.includes("commandMention")||a?.includes("link")||u.type!="text")return;const c=P.getMember(t.guildId,m);if(!(!c||!c.colorString))return{content:[u],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:p.ReactNative.processColor(z(l,c.colorString,s.storage.chatInterpolation/100)),messageChannelId:"0"},medium:!0},type:"link"}};let f=[];s.storage.chatInterpolation>0&&f.push(d),s.storage.noMention||(f.push(i),t.shouldShowRoleOnName=!0,t.referencedMessage?.message&&(t.referencedMessage.message.shouldShowRoleOnName=!0)),t.content&&S({content:t.content},f,[t.authorId]),t.embeds&&t.embeds.forEach(function(u){return S({content:u.description},f,[t.authorId])}),t.referencedMessage?.message?.content&&S({content:t.referencedMessage.message.content},f,[t.referencedMessage.message.authorId])}const{NativeModules:J}=p.ReactNative,{DCDChatManager:q,InfoDictionaryManager:Q,RTNClientInfoManager:Z}=J,ee=Q??Z;function te(){return parseInt(ee.Build)>200013?y.before("updateRows",q,function(e){var t=JSON.parse(e[1]);for(const o of t)D(o);e[1]=JSON.stringify(t)}):y.after("generate",K.prototype,function(e,t){D(t)})}const{View:ne}=p.ReactNative,oe=h.findByStoreName("GuildStore");function re(){return y.after("render",ne,function(e,t){if(s.storage.noRole)return;const o=L.findInReactTree(t,function(l){return l?.props?.roleId});if(!o||isNaN(o.props.roleId)||o.props.excludedApplications||o.props.hasOwnProperty("displayRoleIcon")||o.props.hasOwnProperty("searchable"))return;let i={type:Object.assign({},o.type)};y.after("type",i.type,function(l,d){let f={type:Object.assign({},d.props.children[1].type)};y.after("render",f.type,function(u,r){let n=oe.getGuild(o.props.guildId)?.roles?.[o.props.roleId];n?.colorString&&r.props.style.push({color:n.colorString})}),d.props.children[1].type=f.type}),o.type=i.type})}const{StyleSheet:ae,PanResponder:ie}=p.ReactNative,E=h.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:w}}=h.findByProps("colors","meta"),{View:T}=b.General,{useState:se,useRef:ce}=p.React,B={sliderOff:w(E.theme,R.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:w(E.theme,R.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:w(E.theme,R.semanticColors.MENTION_FOREGROUND)},le=function(e){let{onSlide:t,value:o}=e;const i=o||0,[l,d]=se(0),f=ce(null);function u(a){f.current&&f.current.measure(function(c,N,_,A,x,Ie){let Re=(a-x)/(_-x)*100;const Se=Math.min(Math.max(0,Re),100);t&&t(Se)})}const r=p.React.useRef(ie.create({onStartShouldSetPanResponder:function(a,c){return!0},onStartShouldSetPanResponderCapture:function(a,c){return!0},onMoveShouldSetPanResponder:function(a,c){return!0},onMoveShouldSetPanResponderCapture:function(a,c){return!0},onPanResponderGrant:function(a,c){u(c.x0)},onPanResponderMove:function(a,c){u(c.moveX)},onPanResponderTerminationRequest:function(a,c){return!0},onPanResponderRelease:function(a,c){},onPanResponderTerminate:function(a,c){},onShouldBlockNativeResponder:function(a,c){return!0}})).current;function n(a){d(a.nativeEvent.layout.width)}const m=ae.create({container:{marginLeft:"5%",width:"90%",height:20,borderRadius:25,backgroundColor:B.sliderOff,marginBottom:25},slid:{width:i+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:i===100?25:0,backgroundColor:B.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(l/2),borderRadius:100,backgroundColor:B.thumb}});return p.React.createElement(T,{style:m.container,...r.panHandlers,ref:f},p.React.createElement(T,{style:m.slid},p.React.createElement(T,{style:m.thumb,onLayout:n})))},{Text:ue,View:de}=b.General,fe=h.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:he}}=h.findByProps("colors","meta"),v={Typing:I.getAssetIDByName("ic_messages"),Mention:I.getAssetIDByName("ic_mention_user"),Text:I.getAssetIDByName("ic_add_text"),Voice:I.getAssetIDByName("ic_voice_channel_24px"),Role:I.getAssetIDByName("ic_person_shield")},pe={text:he(fe.theme,R.semanticColors.TEXT_NORMAL)};function ge(e,t,o){const i=function(r){return r.match(/\w\w/g).map(function(n){return parseInt(n,16)})},l=function(r){return"#"+r.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},d=i(e),f=i(t),u=d.map(function(r,n){return Math.round(r+(f[n]-r)*o)});return l(u)}function me(){return G.useProxy(s.storage),s.storage.chatInterpolation??=0,React.createElement(p.ReactNative.ScrollView,{style:{flex:1}},React.createElement(g.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(g.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(g.FormIcon,{source:v.Typing}),value:!s.storage.hideTyping,onValueChange:function(e){return s.storage.hideTyping=!e}}),React.createElement(g.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(g.FormIcon,{source:v.Mention}),value:!s.storage.noMention,onValueChange:function(e){return s.storage.noMention=!e}}),React.createElement(g.FormSwitchRow,{label:"Show in member list",subLabel:"Display the top role color in the member list role section headers.",leading:React.createElement(g.FormIcon,{source:v.Role}),value:!s.storage.noRole,onValueChange:function(e){return s.storage.noRole=!e}}),React.createElement(de,{style:{marginHorizontal:10,marginBottom:2}},React.createElement(b.HelpMessage,{messageType:0},"(Regarding option below) - Limitations cause text coloring to prevent interaction with the text. Instead, you'll have to press anywhere else in the message to open the context menu or use gestures.")),React.createElement(g.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(g.FormIcon,{source:v.Text}),value:s.storage.chatInterpolation>0,onValueChange:function(e){s.storage.chatInterpolation=e?100:0}}),React.createElement(ue,{style:{marginLeft:"5%",color:ge(pe.text,"#ff0000",s.storage.chatInterpolation/100),fontFamily:p.constants.Fonts.DISPLAY_MEDIUM,fontSize:16,marginBottom:5,marginTop:-5}},"Color interpolation (for chat text):"),React.createElement(le,{onSlide:function(e){s.storage.chatInterpolation=e},value:s.storage.chatInterpolation,style:{marginBottom:0}})))}let C=[];var ye={onLoad:function(){C.push(H()),C.push(te()),C.push(re())},onUnload:function(){for(const e of C)e()},settings:me};return M.default=ye,Object.defineProperty(M,"__esModule",{value:!0}),M})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.utils,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
