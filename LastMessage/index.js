(function(l,i,o,n,p,c,S,m,f){"use strict";const{View:w}=c.General,T=o.findByStoreName("RelationshipStore"),{TextStyleSheet:b,Text:x}=o.findByProps("TextStyleSheet"),_=o.find(function(e){return e?.name==="Timestamp"}),{parseTimestamp:L}=o.findByProps("parseTimestamp");function N(){this.listeners=[];const e=this;this.addListener=function(t){return e.listeners.push(t),function(){return e.removeListener(t)}},this.removeListener=function(t){return e.listeners=e.listeners.filter(function(r){return r!==t}),!0},this.fire=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e.listeners.forEach(function(s){return s(...r)}),!0}}const{addListener:d,removeListener:A,fire:P}=new N;let h={};d(function(e,t){let r=Object.entries(T.getRelationships()).filter(function(a){let[,s]=a;return s===1}).map(function(a){let[s]=a;return s});(i.storage.everyone||r.includes(e))&&(h[e]=t)});function B(e){const[t,r]=n.React.useState(h[e]);return n.React.useEffect(function(){const a=function(s,u){s===e&&r(u)};return d(a),function(){return A(a)}},[]),t}const F=function(){function e(t){let{message:r}=t;var a;let s=r==null||(a=r.author)===null||a===void 0?void 0:a.id,u=r?.timestamp;s&&u&&P(s,Math.floor(new Date(u).getTime()/1e3-1))}return n.FluxDispatcher.subscribe("MESSAGE_CREATE",e),function(){return n.FluxDispatcher.unsubscribe("MESSAGE_CREATE",e)}};function C(e){let{id:t}=e;const r=B(t);return!r&&!i.storage.showWhenNone?n.React.createElement(n.React.Fragment,null):n.React.createElement(w,{style:{marginTop:10}},n.React.createElement(x,{style:[b["text-xs/medium"]]},"Last message: "," ",r?n.React.createElement(_,{node:{...L(r.toString(),"R"),type:"timestamp"}}):"Unknown"))}const M=function(){return p.after("default",o.find(function(e){var t;return(e==null||(t=e.default)===null||t===void 0?void 0:t.name)==="UserProfileName"}),function(e,t){let[r]=e;var a,s,u;let E=t==null||(u=t.props)===null||u===void 0||(s=u.children)===null||s===void 0||(a=s.props)===null||a===void 0?void 0:a.children;E&&E.push(n.React.createElement(C,{id:r.user.id}))})};function D(){let e=[F(),M()];return function(){return e.forEach(function(t){return t()})}}const{FormSwitch:v,FormRow:g,FormIcon:y}=c.Forms,{ScrollView:V}=n.ReactNative,k=o.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:G}}=o.findByProps("colors","meta");G(k.theme,m.semanticColors.TEXT_NORMAL),o.findByProps("intword");function I(){S.useProxy(i.storage);const[e,t]=n.React.useState(i.storage.everyone),[r,a]=n.React.useState(i.storage.everyone);function s(){i.storage.everyone=!i.storage.everyone,t(i.storage.everyone)}return n.React.createElement(V,{style:{flex:1,marginTop:10}},n.React.createElement(g,{label:"Log everyone",subLabel:"Log every user instead of only friends. This might make the app slower and use more memory.",leading:n.React.createElement(y,{source:f.getAssetIDByName("ic_header_members_add_24px")}),trailing:n.React.createElement(v,{value:e,onValueChange:s}),onPress:s}),n.React.createElement(g,{label:"Show when unknown",subLabel:"Show the last message text when there is none logged.",leading:n.React.createElement(y,{source:f.getAssetIDByName("ic_text_in_voice_24px")}),trailing:n.React.createElement(v,{value:r,onValueChange:function(){}}),onPress:function(){}}))}let R=[];var O={onLoad:function(){var e,t;(e=i.storage).everyone??(e.everyone=!1),(t=i.storage).showWhenNone??(t.showWhenNone=!1),R.push(D())},onUnload:function(){for(const e of R)e()},settings:I};return l.default=O,Object.defineProperty(l,"__esModule",{value:!0}),l})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.storage,vendetta.ui,vendetta.ui.assets);
