(function(u,i,o,n,R,c,E,p,l){"use strict";const{View:S}=c.General,m=o.findByStoreName("RelationshipStore"),{TextStyleSheet:w,Text:T}=o.findByProps("TextStyleSheet"),b=o.find(function(e){return e?.name==="Timestamp"}),{parseTimestamp:x}=o.findByProps("parseTimestamp");function L(){this.listeners=[];const e=this;this.addListener=function(t){return e.listeners.push(t),function(){return e.removeListener(t)}},this.removeListener=function(t){return e.listeners=e.listeners.filter(function(r){return r!==t}),!0},this.fire=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e.listeners.forEach(function(s){return s(...r)}),!0}}const{addListener:f,removeListener:_,fire:A}=new L;let d={};f(function(e,t){let r=Object.entries(m.getRelationships()).filter(function(a){let[,s]=a;return s===1}).map(function(a){let[s]=a;return s});(i.storage.everyone||r.includes(e))&&(d[e]=t)});function N(e){const[t,r]=n.React.useState(d[e]);return n.React.useEffect(function(){const a=function(s,I){s===e&&r(I)};return f(a),function(){return _(a)}},[]),t}const P=function(){function e(t){let{message:r}=t,a=r?.author?.id,s=r?.timestamp;a&&s&&A(a,Math.floor(new Date(s).getTime()/1e3-1))}return n.FluxDispatcher.subscribe("MESSAGE_CREATE",e),function(){return n.FluxDispatcher.unsubscribe("MESSAGE_CREATE",e)}};function B(e){let{id:t}=e;const r=N(t);return!r&&!i.storage.showWhenNone?n.React.createElement(n.React.Fragment,null):n.React.createElement(S,{style:{marginTop:10}},n.React.createElement(T,{style:[w["text-xs/medium"]]},"Last message: "," ",r?n.React.createElement(b,{node:{...x(r.toString(),"R"),type:"timestamp"}}):"Unknown"))}const F=function(){return R.after("default",o.find(function(e){return e?.default?.name==="UserProfileName"}),function(e,t){let[r]=e,a=t?.props?.children?.props?.children;a&&a.push(n.React.createElement(B,{id:r.user.id}))})};function C(){let e=[P(),F()];return function(){return e.forEach(function(t){return t()})}}const{FormSwitch:h,FormRow:g,FormIcon:v}=c.Forms,{ScrollView:M}=n.ReactNative,D=o.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:V}}=o.findByProps("colors","meta");V(D.theme,p.semanticColors.TEXT_NORMAL),o.findByProps("intword");function k(){E.useProxy(i.storage);const[e,t]=n.React.useState(i.storage.everyone),[r,a]=n.React.useState(i.storage.everyone);function s(){i.storage.everyone=!i.storage.everyone,t(i.storage.everyone)}return n.React.createElement(M,{style:{flex:1,marginTop:10}},n.React.createElement(g,{label:"Log everyone",subLabel:"Log every user instead of only friends. This might make the app slower and use more memory.",leading:n.React.createElement(v,{source:l.getAssetIDByName("ic_header_members_add_24px")}),trailing:n.React.createElement(h,{value:e,onValueChange:s}),onPress:s}),n.React.createElement(g,{label:"Show when unknown",subLabel:"Show the last message text when there is none logged.",leading:n.React.createElement(v,{source:l.getAssetIDByName("ic_text_in_voice_24px")}),trailing:n.React.createElement(h,{value:r,onValueChange:function(){}}),onPress:function(){}}))}let y=[];var G={onLoad:function(){i.storage.everyone??=!1,i.storage.showWhenNone??=!1,y.push(C())},onUnload:function(){for(const e of y)e()},settings:k};return u.default=G,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.storage,vendetta.ui,vendetta.ui.assets);
