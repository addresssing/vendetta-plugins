(function(h,s,y,n,M,_,r,c,T,N){"use strict";const{Text:I}=M.General,B=n.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:C}}=n.findByProps("colors","meta"),D=n.findByStoreName("UserStore"),P=n.findByStoreName("RelationshipStore"),w=n.findByStoreName("GuildMemberStore"),R=n.findByProps("TYPING_WRAPPER_HEIGHT");function A(){return y.after("default",R,function(e,l){let[{channel:i}]=e;if(!l||r.storage.hideTyping)return;const u=l.props?.children,a=C(B.theme,_.semanticColors.HEADER_SECONDARY),S=y.after("type",u,function(d,f){s.React.useEffect(function(){return function(){S()}},[]);const g=f?.props?.children?.[0]?.props?.children?.[1]?.props;if(!g||!g.children||g.children==="Several people are typing...")return;const t=R.useTypingUserIds(i.id).map(function(o){const p=w.getMember(i.guild_id,o),E=D.getUser(o),H=p?.nick||P.getNickname(o)||E.globalName||E.username,V=p?.colorString||a;return{displayName:H,displayColor:V}});function v(o){return s.React.createElement(I,{style:{color:o.displayColor,fontFamily:s.constants.Fonts.DISPLAY_BOLD}},o.displayName)}!t||t.length<1||(g.children=t.length===1?[v(t[0])," is typing..."]:[...t.slice(0,t.length-1).flatMap(function(o,p){return[v(o),p<t.length-2?", ":" and "]}),v(t[t.length-1])," are typing..."])})})}const{DCDChatManager:G}=s.ReactNative.NativeModules,L=n.findByStoreName("GuildMemberStore"),O=n.findByProps("insertText");function F(){return y.before("updateRows",G,function(e){if(r.storage.noMention)return;let l=JSON.parse(e[1]);l.forEach(function(i){if(i.type!=1||!i.message?.content)return;let u=O.refs[0]?.current?.props?.channel;u&&u.guild_id&&i.message.content.forEach(function(a,S){if(a.type!="mention"||!a.userId)return;const d=L.getMember(u.guild_id,a.userId)?.colorString;if(!d)return;const f=parseInt(d.slice(1),16);i.message.content[S]={...a,roleColor:f,color:f,colorString:d}})}),e[1]=JSON.stringify(l)})}const b={Typing:N.getAssetIDByName("ic_messages"),Mention:N.getAssetIDByName("ic_mention_user")};function U(){return T.useProxy(r.storage),React.createElement(s.ReactNative.ScrollView,{style:{flex:1}},React.createElement(c.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(c.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(c.FormIcon,{source:b.Typing}),value:!r.storage.hideTyping,onValueChange:function(e){return r.storage.hideTyping=!e}}),React.createElement(c.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(c.FormIcon,{source:b.Mention}),value:!r.storage.noMention,onValueChange:function(e){return r.storage.noMention=!e}})))}let m=[];var x={onLoad:function(){m.push(A()),m.push(F())},onUnload:function(){for(const e of m)e()},settings:U};return h.default=x,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
