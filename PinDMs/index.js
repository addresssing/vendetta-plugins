(function(C,t,i,r,S,m,L){"use strict";const{Pressable:x}=m.General,{getPrivateChannelRowHeight:H}=i.findByProps("getPrivateChannelRowHeightWithoutPadding"),I=i.findByName("CategoryChannel"),b=i.findByStoreName("UserGuildSettingsStore"),w=i.findByStoreName("ReadStateStore"),U=i.findByName("FastList"),{getPrivateChannelIds:z}=i.findByProps("getPrivateChannelIds"),{getChannelId:F}=i.findByStoreName("SelectedChannelStore");function B(n){if(!(n.addChangeListener||n.addChangeListener))throw new Error("Invalid store provided.");const[,o]=r.React.useReducer(function(c){return~c},0);return r.React.useEffect(function(){const c=function(){return o()};return n.addChangeListener(c),function(){return void n.removeChangeListener(c)}},[]),null}function G(){let n=[],o=!1;return n.push(S.after("default",i.findByName("ConnectedPrivateChannels",!1),function(c,W){if(o)return;o=!0;function O(N){let{id:u,selected:p}=N;const D=w.hasUnread(u),M=b.isChannelMuted(null,u);return!(p||D&&!M)}n.push(S.after("render",W.type.prototype,function(N,u){if(!u.props?.children?.props?.children)return;const p=u.props.children.props.children;function D(k){let{comp:q}=k;L.useProxy(t.storage),B(w),B(b);const f=q,h=t.storage.pinnedDMs;function J(){const s={categories:1+h.length,channels:0,collapsedChannels:0},a=Object.fromEntries(Object.values(h).map(function(e){return[e.id,{channels:[],collapsed:t.storage.collapsedPinnedDMs.includes(e.id)}]}));return z().forEach(function(e,g){let v=h.find(function(l){return l.ids.includes(e)});if(!v)return;s.channels+=1;let d=a[v.id];const P=O({id:e,selected:F()===e});d.collapsed&&P&&(s.collapsedChannels+=1),d.channels.push({id:e,shouldHideIfCategoryIsCollapsed:P,index:g})}),{counts:s,categories:a}}const{counts:R,categories:y}=J();function K(s,a){a?t.storage.collapsedPinnedDMs.includes(s)||(t.storage.collapsedPinnedDMs=[...t.storage.collapsedPinnedDMs,s]):t.storage.collapsedPinnedDMs=t.storage.collapsedPinnedDMs.filter(function(e){return e!=s})}function Q(s,a){return s===0?r.React.createElement(m.ErrorBoundary,null,r.React.createElement(r.React.Fragment,null,Object.entries(y).map(function(e){let[g,{channels:v,collapsed:d}]=e;const P=h.find(function(l){return l.id===g});return r.React.createElement(r.React.Fragment,null,r.React.createElement(x,{onPress:function(){return K(g,!d)}},r.React.createElement(I,{name:P.name,collapsed:d})),v.map(function(l){const E=f.props.renderItem(0,l.index);if(!d)return E;const{selected:V}=E.props;return O({id:l.id,selected:V})?null:E}))}),r.React.createElement(I,{name:"Direct Messages",renderChevron:!1}))):Object.values(y).map(function(e){return e.channels}).flat().some(function(e){return e.index===a})?null:f.props.renderItem(s,a)}function T(s,a){return s===0?32*R.categories+H(1)*(R.channels-R.collapsedChannels):Object.values(y).map(function(e){return e.channels}).flat().some(function(e){return e.index===a})?0:f.props.itemSize(s,a)}return r.React.createElement(U,{...f.props,sections:[1,f.props.sections[0]-0],renderItem:Q,itemSize:T,onScroll:function(){}})}const M=r.React.memo(D);p[2]=r.React.createElement(M,{comp:p[2]})}))})),function(){return n.forEach(function(c){return c()})}}const _={pin:function(n){t.storage.pinnedDMs.push(n)},unpin:function(n){t.storage.pinnedDMs=t.storage.pinnedDMs.filter(function(o){return o!=n})},getPinnedDMs:function(){return t.storage.pinnedDMs}};let j=[];var A={onLoad:function(){t.storage.pinnedDMs??=[],j.push(G()),Object.defineProperty(window,"PinDMsDevApi",{configurable:!0,value:_})},onUnload:function(){for(const n of j)n(),delete window.PinDMsDevApi}};return C.default=A,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.storage);
