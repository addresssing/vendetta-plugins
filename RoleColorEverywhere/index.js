(function(D,h,R,c,_,N,u,z,g,q,M){"use strict";var O,x;const{Text:Q}=_.General,Z=c.findByStoreName("ThemeStore"),ee=((O=c.find(function(t){var e,n;return(n=t.default)===null||n===void 0||(e=n.internal)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||O===void 0?void 0:O.default.internal.resolveSemanticColor)??((x=c.find(function(t){var e;return(e=t.meta)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||x===void 0?void 0:x.meta.resolveSemanticColor)??function(){},te=c.findByStoreName("UserStore"),ne=c.findByStoreName("RelationshipStore"),oe=c.findByStoreName("GuildMemberStore"),W=c.findByProps("TYPING_WRAPPER_HEIGHT");function re(){return R.after("default",W,function(t,e){let[{channel:n}]=t;var o;if(!e||u.storage.hideTyping)return;const s=(o=e.props)===null||o===void 0?void 0:o.children,d=ee(Z.theme,N.semanticColors.HEADER_SECONDARY),v=R.after("type",s,function(m,r){var i,l,a,f,C,y;h.React.useEffect(function(){return function(){v()}},[]);const I=r==null||(y=r.props)===null||y===void 0||(C=y.children)===null||C===void 0||(f=C[0])===null||f===void 0||(a=f.props)===null||a===void 0||(l=a.children)===null||l===void 0||(i=l[1])===null||i===void 0?void 0:i.props;if(!I||!I.children||I.children==="Several people are typing...")return;const p=W.useTypingUserIds(n.id).map(function(S){const E=oe.getMember(n.guild_id,S),X=te.getUser(S),Pe=E?.nick||ne.getNickname(S)||X.globalName||X.username,Le=E?.colorString||d;return{displayName:Pe,displayColor:Le}});function B(S){return h.React.createElement(Q,{style:{color:S.displayColor,fontFamily:h.constants.Fonts.DISPLAY_SEMIBOLD}},S.displayName)}!p||p.length<1||(I.children=p.length===1?[B(p[0])," is typing..."]:[...p.slice(0,p.length-1).flatMap(function(S,E){return[B(S),E<p.length-2?", ":" and "]}),B(p[p.length-1])," are typing..."])})})}var A,P;const ie=c.findByStoreName("ThemeStore"),ae=((A=c.find(function(t){var e,n;return(n=t.default)===null||n===void 0||(e=n.internal)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||A===void 0?void 0:A.default.internal.resolveSemanticColor)??((P=c.find(function(t){var e;return(e=t.meta)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||P===void 0?void 0:P.meta.resolveSemanticColor)??function(){},le=c.findByName("RowManager"),J=c.findByStoreName("GuildMemberStore"),ce=c.findByStoreName("ChannelStore");function b(t,e,n,o){if(t)return o=Object.assign([],o),o?o.push(t):o=[t],Array.isArray(t.content)?t.content.forEach(function(s,d){return t.content[d]=b(s,e,n,o)}):t.items?t.items.forEach(function(s,d){return t.items[d]=b(s,e,n,o)}):Array.isArray(t)&&t.forEach(function(s,d){return t[d]=b(s,e,n,o)}),t.type&&e.forEach(function(s){t=s(t,n,o)||t}),t}function ue(t,e,n){const o=function(r){return r.match(/\w\w/g).map(function(i){return parseInt(i,16)})},s=function(r){return"#"+r.map(function(i){return i.toString(16).padStart(2,"0")}).join("")},d=o(t),v=o(e),m=d.map(function(r,i){return Math.round(r+(v[i]-r)*n)});return s(m)}function K(t){var e,n;const{message:o}=t;if(!o||(!u.storage.chatInterpolation||u.storage.chatInterpolation<=0)&&u.storage.noMention)return;const s=ce.getChannel(o.channelId);if(!s?.guild_id)return;const d=function(l){if(l.type!="mention"||!l.userId)return;const f=J.getMember(s.guild_id,l.userId)?.colorString;if(!f)return;const C=parseInt(f.slice(1),16);return{...l,roleColor:C,color:C,colorString:f}},v=ae(ie.theme,N.semanticColors.TEXT_NORMAL),m=function(l,a,f){let[C]=a,y=f?.map(function(p){return p.type});if(y?.includes("mention")||y?.includes("channelMention")||y?.includes("roleMention")||y?.includes("commandMention")||y?.includes("link")||l.type!="text")return;const I=J.getMember(o.guildId,C);if(!(!I||!I.colorString))return{content:[l],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:h.ReactNative.processColor(ue(v,I.colorString,u.storage.chatInterpolation/100)),messageChannelId:"0"},medium:!0},type:"link"}};let r=[];if(u.storage.chatInterpolation>0&&r.push(m),!u.storage.noMention){var i;r.push(d),o.shouldShowRoleOnName=!0,!((i=o.referencedMessage)===null||i===void 0)&&i.message&&(o.referencedMessage.message.shouldShowRoleOnName=!0)}o.content&&b({content:o.content},r,[o.authorId]),o.embeds&&o.embeds.forEach(function(l){return b({content:l.description},r,[o.authorId])}),!((n=o.referencedMessage)===null||n===void 0||(e=n.message)===null||e===void 0)&&e.content&&b({content:o.referencedMessage.message.content},r,[o.referencedMessage.message.authorId])}const{NativeModules:se}=h.ReactNative,{DCDChatManager:de,InfoDictionaryManager:fe,RTNClientInfoManager:ve}=se,he=fe??ve;function me(){return parseInt(he.Build)>200013?R.before("updateRows",de,function(t){var e=JSON.parse(t[1]);for(const n of e)K(n);t[1]=JSON.stringify(e)}):R.after("generate",le.prototype,function(t,e){K(e)})}var L,$;const pe=c.findByStoreName("ThemeStore"),ge=((L=c.find(function(t){var e,n;return(n=t.default)===null||n===void 0||(e=n.internal)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||L===void 0?void 0:L.default.internal.resolveSemanticColor)??(($=c.find(function(t){var e;return(e=t.meta)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||$===void 0?void 0:$.meta.resolveSemanticColor)??function(){};function ye(){return R.after("default",c.findByName("VoiceUserConnected",!1),function(t,e){let[n]=t;if(!u.storage.noVoice)try{let o=e.type.prototype?["render",e.type.prototype]:["type",e.type];const s=R.after(o[0],o[1],function(d,v){var m,r,i,l;s();let a=(i=v.props)===null||i===void 0||(r=i.children)===null||r===void 0||(m=r[1])===null||m===void 0?void 0:m.props;a&&(a.style.color=(n==null||(l=n.member)===null||l===void 0?void 0:l.colorString)||ge(pe.theme,N.semanticColors.CHANNELS_DEFAULT))})}catch{}})}const{View:Se}=h.ReactNative,Re=c.findByStoreName("GuildStore");function Ce(){return R.after("render",Se,function(t,e){if(u.storage.noRole)return;const n=z.findInReactTree(e,function(s){var d;return s==null||(d=s.props)===null||d===void 0?void 0:d.roleId});if(!n||isNaN(n.props.roleId)||n.props.excludedApplications||n.props.hasOwnProperty("displayRoleIcon")||n.props.hasOwnProperty("searchable"))return;let o={type:Object.assign({},n.type)};R.after("type",o.type,function(s,d){let v={type:Object.assign({},d.props.children[1].type)};R.after("render",v.type,function(m,r){var i,l;let a=(l=Re.getGuild(n.props.guildId))===null||l===void 0||(i=l.roles)===null||i===void 0?void 0:i[n.props.roleId];a?.colorString&&r.props.style.push({color:a.colorString})}),d.props.children[1].type=v.type}),n.type=o.type})}var G,V;const{StyleSheet:Ie,PanResponder:Ne}=h.ReactNative,U=c.findByStoreName("ThemeStore"),k=((G=c.find(function(t){var e,n;return(n=t.default)===null||n===void 0||(e=n.internal)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||G===void 0?void 0:G.default.internal.resolveSemanticColor)??((V=c.find(function(t){var e;return(e=t.meta)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||V===void 0?void 0:V.meta.resolveSemanticColor)??function(){},{View:H}=_.General,{useState:be,useRef:Ee}=h.React,F={sliderOff:k(U.theme,N.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:k(U.theme,N.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:k(U.theme,N.semanticColors.MENTION_FOREGROUND)},Me=function(t){let{onSlide:e,value:n}=t;const o=n||0,[s,d]=be(0),v=Ee(null);function m(a){v.current&&v.current.measure(function(f,C,y,I,p,B){let S=(a-p)/(y-p)*100;const E=Math.min(Math.max(0,S),100);e&&e(E)})}const r=h.React.useRef(Ne.create({onStartShouldSetPanResponder:function(a,f){return!0},onStartShouldSetPanResponderCapture:function(a,f){return!0},onMoveShouldSetPanResponder:function(a,f){return!0},onMoveShouldSetPanResponderCapture:function(a,f){return!0},onPanResponderGrant:function(a,f){m(f.x0)},onPanResponderMove:function(a,f){m(f.moveX)},onPanResponderTerminationRequest:function(a,f){return!0},onPanResponderRelease:function(a,f){},onPanResponderTerminate:function(a,f){},onShouldBlockNativeResponder:function(a,f){return!0}})).current;function i(a){d(a.nativeEvent.layout.width)}const l=Ie.create({container:{marginLeft:"5%",width:"90%",height:20,borderRadius:25,backgroundColor:F.sliderOff,marginBottom:25},slid:{width:o+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:o===100?25:0,backgroundColor:F.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(s/2),borderRadius:100,backgroundColor:F.thumb}});return h.React.createElement(H,{style:l.container,...r.panHandlers,ref:v},h.React.createElement(H,{style:l.slid},h.React.createElement(H,{style:l.thumb,onLayout:i})))};var j,Y;const{Text:we,View:Te}=_.General,_e=c.findByStoreName("ThemeStore"),Be=((j=c.find(function(t){var e,n;return(n=t.default)===null||n===void 0||(e=n.internal)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||j===void 0?void 0:j.default.internal.resolveSemanticColor)??((Y=c.find(function(t){var e;return(e=t.meta)===null||e===void 0?void 0:e.resolveSemanticColor}))===null||Y===void 0?void 0:Y.meta.resolveSemanticColor)??function(){},w={Typing:M.getAssetIDByName("ic_messages"),Mention:M.getAssetIDByName("ic_mention_user"),Text:M.getAssetIDByName("ic_add_text"),Voice:M.getAssetIDByName("ic_voice_channel_24px"),Role:M.getAssetIDByName("ic_person_shield")},De={text:Be(_e.theme,N.semanticColors.TEXT_NORMAL)};function Oe(t,e,n){const o=function(r){return r.match(/\w\w/g).map(function(i){return parseInt(i,16)})},s=function(r){return"#"+r.map(function(i){return i.toString(16).padStart(2,"0")}).join("")},d=o(t),v=o(e),m=d.map(function(r,i){return Math.round(r+(v[i]-r)*n)});return s(m)}function xe(){var t;return q.useProxy(u.storage),(t=u.storage).chatInterpolation??(t.chatInterpolation=0),React.createElement(h.ReactNative.ScrollView,{style:{flex:1}},React.createElement(g.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(g.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(g.FormIcon,{source:w.Typing}),value:!u.storage.hideTyping,onValueChange:function(e){return u.storage.hideTyping=!e}}),React.createElement(g.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(g.FormIcon,{source:w.Mention}),value:!u.storage.noMention,onValueChange:function(e){return u.storage.noMention=!e}}),React.createElement(g.FormSwitchRow,{label:"Show in member list",subLabel:"Display the top role color in the member list role section headers.",leading:React.createElement(g.FormIcon,{source:w.Role}),value:!u.storage.noRole,onValueChange:function(e){return u.storage.noRole=!e}}),React.createElement(Te,{style:{marginHorizontal:10,marginBottom:2}},React.createElement(_.HelpMessage,{messageType:0},"(Regarding option below) - Limitations cause text coloring to prevent interaction with the text. Instead, you'll have to press anywhere else in the message to open the context menu or use gestures.")),React.createElement(g.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(g.FormIcon,{source:w.Text}),value:u.storage.chatInterpolation>0,onValueChange:function(e){u.storage.chatInterpolation=e?100:0}}),React.createElement(we,{style:{marginLeft:"5%",color:Oe(De.text,"#ff0000",u.storage.chatInterpolation/100),fontFamily:h.constants.Fonts.DISPLAY_MEDIUM,fontSize:16,marginBottom:5,marginTop:-5}},"Color interpolation (for chat text):"),React.createElement(Me,{onSlide:function(e){u.storage.chatInterpolation=e},value:u.storage.chatInterpolation,style:{marginBottom:0}}),React.createElement(g.FormSwitchRow,{label:"Show in voice channel member list",subLabel:"Display the top role color in the voice channel member list.",leading:React.createElement(g.FormIcon,{source:w.Voice}),value:!u.storage.noVoice,onValueChange:function(e){u.storage.noVoice=!e}})))}let T=[];var Ae={onLoad:function(){T.push(re()),T.push(me()),T.push(ye()),T.push(Ce())},onUnload:function(){for(const t of T)t()},settings:xe};return D.default=Ae,Object.defineProperty(D,"__esModule",{value:!0}),D})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.utils,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
