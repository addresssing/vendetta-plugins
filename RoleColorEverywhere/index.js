(function(v,d,R,u,N,S,c,p,L,C){"use strict";const{Text:G}=N.General,U=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:V}}=u.findByProps("colors","meta"),$=u.findByStoreName("UserStore"),k=u.findByStoreName("RelationshipStore"),F=u.findByStoreName("GuildMemberStore"),D=u.findByProps("TYPING_WRAPPER_HEIGHT");function j(){return R.after("default",D,function(e,i){let[{channel:t}]=e;if(!i||c.storage.hideTyping)return;const a=i.props?.children,s=V(U.theme,S.semanticColors.HEADER_SECONDARY),h=R.after("type",a,function(f,g){d.React.useEffect(function(){return function(){h()}},[]);const o=g?.props?.children?.[0]?.props?.children?.[1]?.props;if(!o||!o.children||o.children==="Several people are typing...")return;const n=D.useTypingUserIds(t.id).map(function(r){const l=F.getMember(t.guild_id,r),w=$.getUser(r),P=l?.nick||k.getNickname(r)||w.globalName||w.username,x=l?.colorString||s;return{displayName:P,displayColor:x}});function m(r){return d.React.createElement(G,{style:{color:r.displayColor,fontFamily:d.constants.Fonts.DISPLAY_BOLD}},r.displayName)}!n||n.length<1||(o.children=n.length===1?[m(n[0])," is typing..."]:[...n.slice(0,n.length-1).flatMap(function(r,l){return[m(r),l<n.length-2?", ":" and "]}),m(n[n.length-1])," are typing..."])})})}const H=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:Y}}=u.findByProps("colors","meta"),{DCDChatManager:W}=d.ReactNative.NativeModules,O=u.findByStoreName("GuildMemberStore"),K=u.findByStoreName("SelectedChannelStore"),X=u.findByStoreName("ChannelStore");function y(e,i,t){if(e)return Array.isArray(e.content)?e.content.forEach(function(a,s){return e.content[s]=y(a,i,t)}):e.items?e.items.forEach(function(a,s){return e.items[s]=y(a,i,t)}):Array.isArray(e)&&e.forEach(function(a,s){return e[s]=y(a,i,t)}),e.type&&(e=i(e,t)||e),e}function J(e,i,t){const a=function(o){return o.match(/\w\w/g).map(function(n){return parseInt(n,16)})},s=function(o){return"#"+o.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},h=a(e),f=a(i),g=h.map(function(o,n){return Math.round(o+(f[n]-o)*t)});return s(g)}function q(){return R.before("updateRows",W,function(e){if((!c.storage.chatInterpolation||c.storage.chatInterpolation<=0)&&c.storage.noMention)return;let i=JSON.parse(e[1]);i.forEach(function(t){if(t.type!=1||!t.message?.content)return;const a=K.getChannelId();if(!a)return;const s=X.getChannel(a);if(!s.guild_id)return;const h=function(o){if(o.type!="mention"||!o.userId)return;const n=O.getMember(s.guild_id,o.userId)?.colorString;if(!n)return;const m=parseInt(n.slice(1),16);return{...o,roleColor:m,color:m,colorString:n}},f=Y(H.theme,S.semanticColors.TEXT_NORMAL),g=function(o,n){let[m]=n;if(o.type!="text")return;const r=O.getMember(t.message.guildId,m);if(!(!r||!r.colorString))return{content:[o],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:d.ReactNative.processColor(J(f,r.colorString,c.storage.chatInterpolation/100)),messageChannelId:"0"},medium:!0},type:"link"}};c.storage.chatInterpolation>0&&(y({content:t.message.content},g,[t.message.authorId]),t.message.referencedMessage?.message?.content&&y({content:t.message.referencedMessage.message.content},g,[t.message.referencedMessage.message.authorId])),c.storage.noMention||(y({content:t.message.content},h,[]),t.message.referencedMessage?.message?.content&&y({content:t.message.referencedMessage.message.content},h,[]))}),e[1]=JSON.stringify(i)})}function z(){return R.after("default",u.findByName("VoiceUserConnected",!1),function(e,i){let[t]=e;if(c.storage.noVoice||!t?.member?.colorString)return;const a=R.after("render",i.type.prototype,function(s,h){a();let f=h.props?.children?.[1]?.props;f&&(f.style.color=t.member.colorString)})})}function E(){return E=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},E.apply(this,arguments)}function Q(){return E.apply(this,arguments)}const{StyleSheet:Z,PanResponder:ee}=d.ReactNative,M=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:T}}=u.findByProps("colors","meta"),{View:_}=N.General,{useState:te,useRef:ne}=d.React,B={sliderOff:T(M.theme,S.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:T(M.theme,S.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:T(M.theme,S.semanticColors.MENTION_FOREGROUND)},oe=function(e){let{onSlide:i,value:t}=e;const a=t||0,[s,h]=te(0),f=ne(null);function g(r){f.current&&f.current.measure(function(l,w,P,x,A,he){let de=(r-A)/(P-A)*100;const fe=Math.min(Math.max(0,de),100);i&&i(fe)})}const o=d.React.useRef(ee.create({onStartShouldSetPanResponder:function(r,l){return!0},onStartShouldSetPanResponderCapture:function(r,l){return!0},onMoveShouldSetPanResponder:function(r,l){return!0},onMoveShouldSetPanResponderCapture:function(r,l){return!0},onPanResponderGrant:function(r,l){g(l.x0)},onPanResponderMove:function(r,l){g(l.moveX)},onPanResponderTerminationRequest:function(r,l){return!0},onPanResponderRelease:function(r,l){},onPanResponderTerminate:function(r,l){},onShouldBlockNativeResponder:function(r,l){return!0}})).current;function n(r){h(r.nativeEvent.layout.width)}const m=Z.create({container:{marginLeft:"5%",width:"90%",height:20,borderRadius:25,backgroundColor:B.sliderOff,marginBottom:25},slid:{width:a+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:a===100?25:0,backgroundColor:B.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(s/2),borderRadius:100,backgroundColor:B.thumb}});return d.React.createElement(_,Q({style:m.container},o.panHandlers,{ref:f}),d.React.createElement(_,{style:m.slid},d.React.createElement(_,{style:m.thumb,onLayout:n})))},{Text:re}=N.General,ae=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:ie}}=u.findByProps("colors","meta"),I={Typing:C.getAssetIDByName("ic_messages"),Mention:C.getAssetIDByName("ic_mention_user"),Text:C.getAssetIDByName("ic_add_text"),Voice:C.getAssetIDByName("ic_voice_channel_24px")},ce={text:ie(ae.theme,S.semanticColors.TEXT_NORMAL)};function se(e,i,t){const a=function(o){return o.match(/\w\w/g).map(function(n){return parseInt(n,16)})},s=function(o){return"#"+o.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},h=a(e),f=a(i),g=h.map(function(o,n){return Math.round(o+(f[n]-o)*t)});return s(g)}function le(){return L.useProxy(c.storage),c.storage.chatInterpolation??=0,React.createElement(d.ReactNative.ScrollView,{style:{flex:1}},React.createElement(p.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(p.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(p.FormIcon,{source:I.Typing}),value:!c.storage.hideTyping,onValueChange:function(e){return c.storage.hideTyping=!e}}),React.createElement(p.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(p.FormIcon,{source:I.Mention}),value:!c.storage.noMention,onValueChange:function(e){return c.storage.noMention=!e}}),React.createElement(p.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(p.FormIcon,{source:I.Text}),value:c.storage.chatInterpolation>0,onValueChange:function(e){c.storage.chatInterpolation=e?100:0}}),React.createElement(re,{style:{marginLeft:"5%",color:se(ce.text,"#ff0000",c.storage.chatInterpolation/100),fontFamily:d.constants.Fonts.DISPLAY_MEDIUM,fontSize:16,marginBottom:5,marginTop:-5}},"Color interpolation (for chat text):"),React.createElement(oe,{onSlide:function(e){c.storage.chatInterpolation=e},value:c.storage.chatInterpolation,style:{marginBottom:0}}),React.createElement(p.FormSwitchRow,{label:"Show in voice channel member list",subLabel:"Display the top role color in the voice channel member list.",leading:React.createElement(p.FormIcon,{source:I.Voice}),value:!c.storage.noVoice,onValueChange:function(e){c.storage.noVoice=!e}})))}let b=[];var ue={onLoad:function(){b.push(j()),b.push(q()),b.push(z())},onUnload:function(){for(const e of b)e()},settings:le};return v.default=ue,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
