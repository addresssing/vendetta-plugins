(function(T,s,i,e,D,l,Q,j,W,Z,x){"use strict";const{Pressable:ee}=l.General,{getPrivateChannelRowHeight:ne}=i.findByProps("getPrivateChannelRowHeightWithoutPadding"),G=i.findByName("CategoryChannel"),z=i.findByStoreName("UserGuildSettingsStore"),Y=i.findByStoreName("ReadStateStore"),{getChannelId:te}=i.findByStoreName("SelectedChannelStore"),re=i.findByName("FastList"),{getPrivateChannelIds:ie}=i.findByProps("getPrivateChannelIds"),{shouldShowMessageRequests:S}=i.findByProps("shouldShowMessageRequests");function $(n){if(!(n.addChangeListener||n.addChangeListener))throw new Error("Invalid store provided.");const[,r]=e.React.useReducer(function(t){return~t},0);return e.React.useEffect(function(){const t=function(){return r()};return n.addChangeListener(t),function(){return void n.removeChangeListener(t)}},[]),null}function ae(){let n=[],r=!1;return n.push(D.after("default",i.findByName("ConnectedPrivateChannels",!1),function(t,R){if(r)return;r=!0;function p(h){let{id:a,selected:o}=h;const u=Y.hasUnread(a),g=z.isChannelMuted(null,a);return!(o||u&&!g)}n.push(D.after("render",R.type.prototype,function(h,a){var o,u,g;if(!(!((g=a.props)===null||g===void 0||(u=g.children)===null||u===void 0||(o=u.props)===null||o===void 0)&&o.children))return;const A=a.props.children.props.children;function B(De){let{comp:Ie}=De;Q.useProxy(s.storage),$(Y),$(z);const C=Ie,w=s.storage.pinnedDMs;function Ae(){const d={categories:1+w.length,channels:0,collapsedChannels:0},f=Object.fromEntries(Object.values(w).map(function(c){return[c.id,{channels:[],collapsed:s.storage.collapsedPinnedDMs.includes(c.id)}]}));return ie().forEach(function(c,b){let L=w.find(function(v){return v.ids.includes(c)});if(!L)return;d.channels+=1;let E=f[L.id];const N=p({id:c,selected:te()===c});E.collapsed&&N&&(d.collapsedChannels+=1),E.channels.push({id:c,shouldHideIfCategoryIsCollapsed:N,index:b+ +S()})}),{counts:d,categories:f}}const{counts:k,categories:V}=Ae();function we(d,f){f?s.storage.collapsedPinnedDMs.includes(d)||(s.storage.collapsedPinnedDMs=[...s.storage.collapsedPinnedDMs,d]):s.storage.collapsedPinnedDMs=s.storage.collapsedPinnedDMs.filter(function(c){return c!=d})}function be(d,f){return d===0?e.React.createElement(l.ErrorBoundary,null,e.React.createElement(e.React.Fragment,null,S()&&C.props.renderItem(0,0),Object.entries(V).map(function(c){let[b,{channels:L,collapsed:E}]=c;const N=w.find(function(v){return v.id===b});return e.React.createElement(e.React.Fragment,null,e.React.createElement(ee,{onPress:function(){return we(b,!E)}},e.React.createElement(G,{name:N.name,collapsed:E})),L.map(function(v){const H=C.props.renderItem(0,v.index);if(!E)return H;const{selected:Ne}=H.props;return p({id:v.id,selected:Ne})?null:H}))}),e.React.createElement(G,{name:"Direct Messages",renderChevron:!1}))):Object.values(V).map(function(c){return c.channels}).flat().some(function(c){return c.index===f})||S()&&!f?null:C.props.renderItem(d,f)}function Le(d,f){return d===0?32*k.categories+ne(1)*(k.channels-k.collapsedChannels+ +S()):Object.values(V).map(function(c){return c.channels}).flat().some(function(c){return c.index===f})||S()&&!f?0:C.props.itemSize(d,f)}return e.React.createElement(re,{...C.props,sections:[1,C.props.sections[0]],renderItem:be,itemSize:Le,onScroll:function(){}})}A[2]=e.React.createElement(B,{comp:A[2]})}))})),function(){return n.forEach(function(t){return t()})}}const{fromTimestamp:oe}=i.findByProps("extractTimestamp"),y={pin:function(n,r){if(y.isPinned(n))return;const t=s.storage.pinnedDMs.findIndex(function(R){return R.id===r});s.storage.pinnedDMs[t].ids=[...s.storage.pinnedDMs[t].ids,n]},unpin:function(n){const r=s.storage.pinnedDMs.findIndex(function(t){return t.ids.includes(n)});s.storage.pinnedDMs[r]={...s.storage.pinnedDMs[r],ids:s.storage.pinnedDMs[r].ids.filter(function(t){return t!=n})}},isPinned:function(n){return s.storage.pinnedDMs.some(function(r){return r.ids.includes(n)})},getPinnedDMs:function(){return s.storage.pinnedDMs},createCategory:function(n){s.storage.pinnedDMs.push({ids:[],id:oe(+Date.now()),name:n})},deleteCategory:function(n){s.storage.pinnedDMs=s.storage.pinnedDMs.filter(function(r){return r.id!=n})}};var m;const{ClearButtonVisibility:se,default:ce}=i.findByProps("ClearButtonVisibility"),{TextStyleSheet:Te,Text:de}=i.findByProps("TextStyleSheet"),M=i.findByProps("openLazy","hideActionSheet"),K=((m=i.findByProps("ActionSheet"))===null||m===void 0?void 0:m.ActionSheet)??i.find(function(n){var r;return((r=n.render)===null||r===void 0?void 0:r.name)==="ActionSheet"}),{BottomSheetScrollView:xe,BottomSheetFlatList:le}=i.findByProps("BottomSheetScrollView"),{ActionSheetTitleHeader:ue,ActionSheetCloseButton:fe,ActionSheetRow:pe}=i.findByProps("ActionSheetTitleHeader"),P=pe??l.Forms.FormRow;function q(n,r){K?M?.openLazy(new Promise(function(t){return t({default:n})}),"ActionSheet",r):Z.showToast("You cannot open ActionSheets on this version! Upgrade to 163+")}const{View:O}=l.General,U=i.findByStoreName("ThemeStore"),he=i.findByName("ConnectedKeyboardAwareView"),{meta:{resolveSemanticColor:F}}=i.findByProps("colors","meta"),{useOrientationSettling:ge}=i.findByProps("useOrientation"),X=i.findByProps("pushModal");function ye(n){let{onExit:r}=n;X.pushModal({key:"pin-dms-new",modal:{key:"pin-dms-new",modal:Re,animation:"slide-up",props:{onExit:r},shouldPersistUnderModals:!1,closable:!0}})}function Re(n){let{onExit:r}=n;var t;ge();const R=(t=e.ReactNative.Dimensions)===null||t===void 0?void 0:t.get("window").width,[p,h]=e.React.useState(""),[a,o]=e.React.useState("");function u(){X.popModal("pin-dms-new"),r()}function g(){if(!p.length||y.getPinnedDMs().find(function(B){return B.name===p}))return o("Invalid category name.");y.createCategory(p),u()}function A(B){h(B),a.length&&o("")}return e.React.createElement(O,{style:{flex:1,backgroundColor:"#000000b3",justifyContent:"center",alignItems:"center"}},e.React.createElement(he,null,e.React.createElement(O,{style:{borderRadius:8,padding:16,backgroundColor:F(U.theme,x.semanticColors.BACKGROUND_PRIMARY),width:R*.9}},e.React.createElement(de,{variant:"heading-lg/extrabold",style:{textAlign:"center"}},e.i18n.Messages.CATEGORY_NAME_PLACEHOLDER),e.React.createElement(ce,{value:"",error:a,onChangeText:A,placeholder:e.i18n.Messages.CATEGORY_NAME,inputTextColor:F(U.theme,x.semanticColors.TEXT_NORMAL),placeholderTextColor:F(U.theme,x.semanticColors.INPUT_PLACEHOLDER_TEXT),clearButtonVisibility:se.NEVER,showBorder:!0,showTopContainer:!0,disabled:!1,autoFocus:!0,numberOfLines:1,returnKeyType:"done",style:{paddingHorizontal:8,paddingVertical:0}}),e.React.createElement(O,{style:{marginTop:24}},e.React.createElement(l.Button,{text:"Save",color:"brand",look:l.Button.Looks.FILLED,onPress:g}),e.React.createElement(l.Button,{text:"Cancel",look:l.Button.Looks.OUTLINED,style:{marginTop:8},onPress:u})))))}const Pe=i.findByStoreName("ChannelStore"),{getUserAvatarURL:Ce,getChannelIconURL:Ee}=i.findByProps("getUserAvatarURL","getChannelIconURL"),ve=i.findByStoreName("RelationshipStore"),{computeChannelName:Se}=i.findByProps("computeChannelName");function J(n){let{channelId:r}=n;const t=Pe.getChannel(r),R=t.type==3?Se(t):ve.getNickname(t.recipients[0])??t.rawRecipients[0].global_name??t.rawRecipients[0].globalName;if(t.type!=1&&t.type!=3)return;function p(){if(t.type==1){const a=t.rawRecipients[0],o=Ce(a,!1,50);return a.avatar?{uri:o}:o}else{const{id:a,icon:o,applicationId:u}=t,g=Ee({id:a,icon:o,applicationId:u,size:32});return o?{uri:g}:g}}const h=[...y.getPinnedDMs().map(function(a){return{id:a.id,label:a.name,icon:null,onPress:function(){return M.hideActionSheet(),y.pin(r,a.id)}}}),{id:"add",label:e.i18n.Messages.CATEGORY_NAME_PLACEHOLDER,icon:j.getAssetIDByName("ic_add_24px"),onPress:function(){return M.hideActionSheet(),ye({onExit:function(){return q(J,{channelId:r})}})}}];return e.React.createElement(K,null,e.React.createElement(ue,{title:`Pinning ${R}`,leading:e.React.createElement(e.ReactNative.Image,{source:p(),style:{width:24,height:24,borderRadius:12,marginRight:12}}),trailing:e.React.createElement(fe,{onPress:function(){return M.hideActionSheet()}})}),e.React.createElement(l.Forms.FormTitle,{title:"Add to category"}),e.React.createElement(le,{style:{flex:1},contentContainerStyle:{paddingBottom:48,marginBottom:8},data:h,renderItem:function(a){let{item:o}=a;return e.React.createElement(P,{label:o.label,onPress:o.onPress,icon:e.React.createElement(P.Icon,{source:o.icon,IconComponent:function(){return e.React.createElement(l.Forms.FormIcon,{source:o.icon})}})})},ItemSeparatorComponent:null,keyExtractor:function(a){return a.id}}))}const I=j.getAssetIDByName("icon-pins");function Me(){return D.after("default",i.findByName("ChannelLongPressActionSheet",!1),function(n,r){let[t]=n;D.after("type",r,function(R,p){var h,a;const o=(a=W.findInReactTree(p,function(u){return u.key==="dm"}))===null||a===void 0||(h=a.props)===null||h===void 0?void 0:h.children;o&&(y.isPinned(t.channelId)?o.push(e.React.createElement(P,{label:"Unpin DM",icon:e.React.createElement(P.Icon,{source:I,IconComponent:function(){return e.React.createElement(l.Forms.FormIcon,{source:I})}}),onPress:function(){return M.hideActionSheet(),y.unpin(t.channelId)}})):o.push(e.React.createElement(P,{label:"Pin DM",icon:e.React.createElement(P.Icon,{source:I,IconComponent:function(){return e.React.createElement(l.Forms.FormIcon,{source:I})}}),onPress:function(){return q(J,{channelId:t.channelId})}})))})})}let _=[];var Be={onLoad:function(){var n,r;(n=s.storage).pinnedDMs??(n.pinnedDMs=[{id:"default",name:"Pinned DMs",ids:[]}]),(r=s.storage).collapsedPinnedDMs??(r.collapsedPinnedDMs=[]),_.push(ae()),_.push(Me()),Object.defineProperty(window,"PinDMsDevApi",{configurable:!0,value:y})},onUnload:function(){for(const n of _)n(),delete window.PinDMsDevApi}};return T.default=Be,Object.defineProperty(T,"__esModule",{value:!0}),T})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.storage,vendetta.ui.assets,vendetta.utils,vendetta.ui.toasts,vendetta.ui);
