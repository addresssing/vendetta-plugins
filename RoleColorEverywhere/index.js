(function(m,u,p,t,M,T,o,c,I,S){"use strict";const{Text:_}=M.General,B=t.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:w}}=t.findByProps("colors","meta"),D=t.findByStoreName("UserStore"),A=t.findByStoreName("RelationshipStore"),P=t.findByStoreName("GuildMemberStore"),b=t.findByProps("TYPING_WRAPPER_HEIGHT");function x(){return p.after("default",b,function(e,a){let[{channel:n}]=e;if(!a||o.storage.hideTyping)return;const s=a.props?.children,g=w(B.theme,T.semanticColors.HEADER_SECONDARY),h=p.after("type",s,function(d,f){u.React.useEffect(function(){return function(){h()}},[]);const l=f?.props?.children?.[0]?.props?.children?.[1]?.props;if(!l||!l.children||l.children==="Several people are typing...")return;const r=b.useTypingUserIds(n.id).map(function(i){const y=P.getMember(n.guild_id,i),E=D.getUser(i),$=y?.nick||A.getNickname(i)||E.globalName||E.username,k=y?.colorString||g;return{displayName:$,displayColor:k}});function C(i){return u.React.createElement(_,{style:{color:i.displayColor,fontFamily:u.constants.Fonts.DISPLAY_BOLD}},i.displayName)}!r||r.length<1||(l.children=r.length===1?[C(r[0])," is typing..."]:[...r.slice(0,r.length-1).flatMap(function(i,y){return[C(i),y<r.length-2?", ":" and "]}),C(r[r.length-1])," are typing..."])})})}const{DCDChatManager:L}=u.ReactNative.NativeModules,G=t.findByStoreName("GuildMemberStore"),O=t.findByStoreName("SelectedChannelStore"),F=t.findByStoreName("ChannelStore");function N(e,a){if(e)return Array.isArray(e.content)&&e.content.forEach(function(n,s){return e.content[s]=N(n,a)}),e.type&&(e=a(e)||e),e}function U(){return p.before("updateRows",L,function(e){if(o.storage.noMention)return;let a=JSON.parse(e[1]);a.forEach(function(n){if(n.type!=1||!n.message?.content)return;const s=O.getChannelId();if(!s)return;const g=F.getChannel(s);if(!g.guild_id)return;const h=function(d){if(d.type!="mention"||!d.userId)return;const f=G.getMember(g.guild_id,d.userId)?.colorString;if(!f)return;const l=parseInt(f.slice(1),16);return{...d,roleColor:l,color:l,colorString:f}};N({content:n.message.content},h),n.message.referencedMessage?.message?.content&&N({content:n.message.referencedMessage.message.content},h)}),e[1]=JSON.stringify(a)})}console.log("d0"),console.log("d1");const V=t.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:H}}=t.findByProps("colors","meta"),R={Typing:S.getAssetIDByName("ic_messages"),Mention:S.getAssetIDByName("ic_mention_user"),Text:S.getAssetIDByName("ic_add_text")};H(V.theme,semanticColors.TEXT_NORMAL);function W(){return console.log("d2"),I.useProxy(o.storage),React.createElement(u.ReactNative.ScrollView,{style:{flex:1}},React.createElement(c.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(c.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(c.FormIcon,{source:R.Typing}),value:!o.storage.hideTyping,onValueChange:function(e){return o.storage.hideTyping=!e}}),React.createElement(c.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(c.FormIcon,{source:R.Mention}),value:!o.storage.noMention,onValueChange:function(e){return o.storage.noMention=!e}}),React.createElement(c.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(c.FormIcon,{source:R.Typing}),value:o.storage.chatInterpolation>0,onValueChange:function(e){o.storage.chatInterpolation=e?100:0}})))}let v=[];var Y={onLoad:function(){console.log("s0"),console.log("s1"),console.log("s2"),v.push(x()),v.push(U())},onUnload:function(){for(const e of v)e()},settings:W};return m.default=Y,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
