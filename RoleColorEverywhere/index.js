(function(v,h,R,l,E,S,c,p,L,I){"use strict";const{Text:G}=E.General,U=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:V}}=l.findByProps("colors","meta"),$=l.findByStoreName("UserStore"),k=l.findByStoreName("RelationshipStore"),F=l.findByStoreName("GuildMemberStore"),D=l.findByProps("TYPING_WRAPPER_HEIGHT");function j(){return R.after("default",D,function(e,a){let[{channel:i}]=e;if(!a||c.storage.hideTyping)return;const t=a.props?.children,u=V(U.theme,S.semanticColors.HEADER_SECONDARY),m=R.after("type",t,function(d,g){h.React.useEffect(function(){return function(){m()}},[]);const r=g?.props?.children?.[0]?.props?.children?.[1]?.props;if(!r||!r.children||r.children==="Several people are typing...")return;const n=D.useTypingUserIds(i.id).map(function(o){const s=F.getMember(i.guild_id,o),w=$.getUser(o),P=s?.nick||k.getNickname(o)||w.globalName||w.username,A=s?.colorString||u;return{displayName:P,displayColor:A}});function f(o){return h.React.createElement(G,{style:{color:o.displayColor,fontFamily:h.constants.Fonts.DISPLAY_BOLD}},o.displayName)}!n||n.length<1||(r.children=n.length===1?[f(n[0])," is typing..."]:[...n.slice(0,n.length-1).flatMap(function(o,s){return[f(o),s<n.length-2?", ":" and "]}),f(n[n.length-1])," are typing..."])})})}const H=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:Y}}=l.findByProps("colors","meta"),W=l.findByName("RowManager"),x=l.findByStoreName("GuildMemberStore");l.findByStoreName("SelectedChannelStore");const K=l.findByStoreName("ChannelStore");function y(e,a,i){if(e)return Array.isArray(e.content)?e.content.forEach(function(t,u){return e.content[u]=y(t,a,i)}):e.items?e.items.forEach(function(t,u){return e.items[u]=y(t,a,i)}):Array.isArray(e)&&e.forEach(function(t,u){return e[u]=y(t,a,i)}),e.type&&(e=a(e,i)||e),e}function X(e,a,i){const t=function(r){return r.match(/\w\w/g).map(function(n){return parseInt(n,16)})},u=function(r){return"#"+r.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},m=t(e),d=t(a),g=m.map(function(r,n){return Math.round(r+(d[n]-r)*i)});return u(g)}function q(){return R.after("generate",W.prototype,function(e,a){let[i]=e,{message:t}=a;if((!c.storage.chatInterpolation||c.storage.chatInterpolation<=0)&&c.storage.noMention||i.rowType!=1||!t?.content)return;const u=t.channelId,m=K.getChannel(u);if(!m?.guild_id)return;const d=function(n){if(n.type!="mention"||!n.userId)return;const f=x.getMember(m.guild_id,n.userId)?.colorString;if(!f)return;const o=parseInt(f.slice(1),16);return{...n,roleColor:o,color:o,colorString:f}},g=Y(H.theme,S.semanticColors.TEXT_NORMAL),r=function(n,f){let[o]=f;if(n.type!="text")return;const s=x.getMember(t.guildId,o);if(!(!s||!s.colorString))return{content:[n],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:h.ReactNative.processColor(X(g,s.colorString,c.storage.chatInterpolation/100)),messageChannelId:"0"},medium:!0},type:"link"}};c.storage.chatInterpolation>0&&(y({content:t.content},r,[t.authorId]),t.referencedMessage?.message?.content&&y({content:t.referencedMessage.message.content},r,[t.referencedMessage.message.authorId])),c.storage.noMention||(y({content:t.content},d,[]),t.referencedMessage?.message?.content&&y({content:t.referencedMessage.message.content},d,[]))})}function z(){return R.after("default",l.findByName("VoiceUserConnected",!1),function(e,a){let[i]=e;if(c.storage.noVoice||!i?.member?.colorString)return;const t=R.after("render",a.type.prototype,function(u,m){t();let d=m.props?.children?.[1]?.props;d&&(d.style.color=i.member.colorString)})})}function N(){return N=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},N.apply(this,arguments)}function Q(){return N.apply(this,arguments)}const{StyleSheet:J,PanResponder:Z}=h.ReactNative,M=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:T}}=l.findByProps("colors","meta"),{View:_}=E.General,{useState:ee,useRef:te}=h.React,B={sliderOff:T(M.theme,S.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:T(M.theme,S.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:T(M.theme,S.semanticColors.MENTION_FOREGROUND)},ne=function(e){let{onSlide:a,value:i}=e;const t=i||0,[u,m]=ee(0),d=te(null);function g(o){d.current&&d.current.measure(function(s,w,P,A,O,fe){let ue=(o-O)/(P-O)*100;const de=Math.min(Math.max(0,ue),100);a&&a(de)})}const r=h.React.useRef(Z.create({onStartShouldSetPanResponder:function(o,s){return!0},onStartShouldSetPanResponderCapture:function(o,s){return!0},onMoveShouldSetPanResponder:function(o,s){return!0},onMoveShouldSetPanResponderCapture:function(o,s){return!0},onPanResponderGrant:function(o,s){g(s.x0)},onPanResponderMove:function(o,s){g(s.moveX)},onPanResponderTerminationRequest:function(o,s){return!0},onPanResponderRelease:function(o,s){},onPanResponderTerminate:function(o,s){},onShouldBlockNativeResponder:function(o,s){return!0}})).current;function n(o){m(o.nativeEvent.layout.width)}const f=J.create({container:{marginLeft:"5%",width:"90%",height:20,borderRadius:25,backgroundColor:B.sliderOff,marginBottom:25},slid:{width:t+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:t===100?25:0,backgroundColor:B.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(u/2),borderRadius:100,backgroundColor:B.thumb}});return h.React.createElement(_,Q({style:f.container},r.panHandlers,{ref:d}),h.React.createElement(_,{style:f.slid},h.React.createElement(_,{style:f.thumb,onLayout:n})))},{Text:oe}=E.General,re=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:ae}}=l.findByProps("colors","meta"),C={Typing:I.getAssetIDByName("ic_messages"),Mention:I.getAssetIDByName("ic_mention_user"),Text:I.getAssetIDByName("ic_add_text"),Voice:I.getAssetIDByName("ic_voice_channel_24px")},ie={text:ae(re.theme,S.semanticColors.TEXT_NORMAL)};function ce(e,a,i){const t=function(r){return r.match(/\w\w/g).map(function(n){return parseInt(n,16)})},u=function(r){return"#"+r.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},m=t(e),d=t(a),g=m.map(function(r,n){return Math.round(r+(d[n]-r)*i)});return u(g)}function se(){return L.useProxy(c.storage),c.storage.chatInterpolation??=0,React.createElement(h.ReactNative.ScrollView,{style:{flex:1}},React.createElement(p.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(p.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(p.FormIcon,{source:C.Typing}),value:!c.storage.hideTyping,onValueChange:function(e){return c.storage.hideTyping=!e}}),React.createElement(p.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(p.FormIcon,{source:C.Mention}),value:!c.storage.noMention,onValueChange:function(e){return c.storage.noMention=!e}}),React.createElement(p.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(p.FormIcon,{source:C.Text}),value:c.storage.chatInterpolation>0,onValueChange:function(e){c.storage.chatInterpolation=e?100:0}}),React.createElement(oe,{style:{marginLeft:"5%",color:ce(ie.text,"#ff0000",c.storage.chatInterpolation/100),fontFamily:h.constants.Fonts.DISPLAY_MEDIUM,fontSize:16,marginBottom:5,marginTop:-5}},"Color interpolation (for chat text):"),React.createElement(ne,{onSlide:function(e){c.storage.chatInterpolation=e},value:c.storage.chatInterpolation,style:{marginBottom:0}}),React.createElement(p.FormSwitchRow,{label:"Show in voice channel member list",subLabel:"Display the top role color in the voice channel member list.",leading:React.createElement(p.FormIcon,{source:C.Voice}),value:!c.storage.noVoice,onValueChange:function(e){c.storage.noVoice=!e}})))}let b=[];var le={onLoad:function(){b.push(j()),b.push(q()),b.push(z())},onUnload:function(){for(const e of b)e()},settings:se};return v.default=le,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
