(function(p,l,m,n,E,_,i,u,I,R){"use strict";const{Text:B}=E.General,T=n.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:D}}=n.findByProps("colors","meta"),w=n.findByStoreName("UserStore"),A=n.findByStoreName("RelationshipStore"),P=n.findByStoreName("GuildMemberStore"),M=n.findByProps("TYPING_WRAPPER_HEIGHT");function G(){return m.after("default",M,function(e,r){let[{channel:t}]=e;if(!r||i.storage.hideTyping)return;const s=r.props?.children,g=D(T.theme,_.semanticColors.HEADER_SECONDARY),h=m.after("type",s,function(d,f){l.React.useEffect(function(){return function(){h()}},[]);const c=f?.props?.children?.[0]?.props?.children?.[1]?.props;if(!c||!c.children||c.children==="Several people are typing...")return;const o=M.useTypingUserIds(t.id).map(function(a){const y=P.getMember(t.guild_id,a),b=w.getUser(a),k=y?.nick||A.getNickname(a)||b.globalName||b.username,x=y?.colorString||g;return{displayName:k,displayColor:x}});function v(a){return l.React.createElement(B,{style:{color:a.displayColor,fontFamily:l.constants.Fonts.DISPLAY_BOLD}},a.displayName)}!o||o.length<1||(c.children=o.length===1?[v(o[0])," is typing..."]:[...o.slice(0,o.length-1).flatMap(function(a,y){return[v(a),y<o.length-2?", ":" and "]}),v(o[o.length-1])," are typing..."])})})}const{DCDChatManager:L}=l.ReactNative.NativeModules,O=n.findByStoreName("GuildMemberStore"),F=n.findByStoreName("SelectedChannelStore"),U=n.findByStoreName("ChannelStore");function S(e,r){if(e)return Array.isArray(e.content)&&e.content.forEach(function(t,s){return e.content[s]=S(t,r)}),e.type&&(e=r(e)||e),e}function H(){return m.before("updateRows",L,function(e){if(i.storage.noMention)return;let r=JSON.parse(e[1]);r.forEach(function(t){if(t.type!=1||!t.message?.content)return;const s=F.getChannelId();if(!s)return;const g=U.getChannel(s);if(!g.guild_id)return;const h=function(d){if(d.type!="mention"||!d.userId)return;const f=O.getMember(g.guild_id,d.userId)?.colorString;if(!f)return;const c=parseInt(f.slice(1),16);return{...d,roleColor:c,color:c,colorString:f}};S({content:t.message.content},h),t.message.referencedMessage?.message?.content&&S({content:t.message.referencedMessage.message.content},h)}),e[1]=JSON.stringify(r)})}const C={Typing:R.getAssetIDByName("ic_messages"),Mention:R.getAssetIDByName("ic_mention_user")};function V(){return I.useProxy(i.storage),React.createElement(l.ReactNative.ScrollView,{style:{flex:1}},React.createElement(u.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(u.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(u.FormIcon,{source:C.Typing}),value:!i.storage.hideTyping,onValueChange:function(e){return i.storage.hideTyping=!e}}),React.createElement(u.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(u.FormIcon,{source:C.Mention}),value:!i.storage.noMention,onValueChange:function(e){return i.storage.noMention=!e}})))}let N=[];var Y={onLoad:function(){N.push(G()),N.push(H())},onUnload:function(){for(const e of N)e()},settings:V};return p.default=Y,Object.defineProperty(p,"__esModule",{value:!0}),p})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
