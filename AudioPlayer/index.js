(function(y,D,A,x){"use strict";const b=4259920+Math.floor(Math.random()*4089)+8;let w={id:"0",state:"untouched",sliderIndex:"0",duration:0,channelId:"0",messageId:"0"};function S(){return w}function l(n){w={...w,...n}}function E(n){const i=Math.floor(n/1e3),e=String(Math.floor(i/60)).padStart(2,"0"),r=String(i%60).padStart(2,"0");return`${e}:${r}`}function s(n,i){let e={channelId:n,messageId:i,userId:"4259920",emoji:{name:"update",id:"4259920"},burst:!1,colors:void 0,messageAuthorId:void 0};x.FluxDispatcher.dispatch({...e,type:"MESSAGE_REACTION_ADD"}),x.FluxDispatcher.dispatch({...e,type:"MESSAGE_REACTION_REMOVE"})}const _={type:"rich",spoiler:"",provider:void 0,author:void 0,rawTitle:void 0,title:void 0,url:void 0,rawDescription:"",description:[{content:"",type:"text"}],thumbnail:void 0,image:void 0,images:void 0,fields:[],footer:void 0,video:void 0,borderLeftColor:-14803166,providerColor:-3880498,headerTextColor:-4867391,bodyTextColor:-2367775,referenceId:void 0,backgroundColor:void 0},N=D.findByName("RowManager"),P=new Set(["mp3","m4a","ogg","wav"]);function B(n,i,e,r,t,a){var o;let d=Buffer.from(t).toString("base64"),m=function(T){let{index:v,content:I}=T;return{type:"link",target:`https://discord.com/channels/${b}/${v}/${i}/${n}/${e}/${d}`,content:[{type:"inlineCode",content:I}]}},u=S(),c=u.id===e,$=c?u.sliderIndex:"0",p=c?u.state==="playing":!1,C=c?(o=u.time)===null||o===void 0?void 0:o.t:void 0,F=Array.from({length:20}).map(function(T,v){let I="\u25AC";return v.toString()===$&&(I="\u2586"),m({index:v,content:I})}),G=c?[{type:"text",content:u.state+" \u2014 "},{type:"strong",content:[{type:"text",content:E(C??0)}]},{type:"text",content:" / "},{type:"strong",content:[{type:"text",content:E(u.duration)}]},{type:"text",content:`
`}]:[{type:"text",content:`
`}];return{..._,author:{name:r,url:t},description:[{content:[...G,...F,{type:"heading",content:[m(p?{index:200,content:"\u0965"}:{index:100,content:"\u25B6"})],level:1}],type:"paragraph"}],footer:{content:a}}}function R(){return A.after("generate",N.prototype,function(n,i){let{message:e}=i;var r,t;if(!e?.embeds||!(!(e==null||(r=e.attachments)===null||r===void 0)&&r.length))return;let a=[],o=[];e.attachments.forEach(function(d){P.has(d.filename.toLowerCase().split(".").pop())?a.push(B(e.id,e.channelId,d.id,d.filename,d.url,d.size)):o.push(d)}),a.length&&(e.embeds.push(...a),e.attachments=o),!(e==null||(t=e.reactions)===null||t===void 0)&&t.length&&(e.reactions=e.reactions.filter(function(d){return d.emoji.id!="4259920"}))})}let g=!1;const{DCDSoundManager:f}=x.ReactNative.NativeModules;function O(n){return console.log("Preparing",n),console.log({isAudioPrepared:g}),g&&f.release(4259920),g=!0,new Promise(function(i){return f.prepare(n,"ring_tone",4259920,function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return i(r)})})}let M=!1;function j(){const n=A.instead("default",D.findByName("safeTransitionTo",!1),function(i,e){let r=i[0].split("/");if(r[2]===b.toString()){let[,,,t,a,o,d,m]=r,u=S();if(u.id!=d){if(M)return new Promise(function(p){return p(void 0)});M=!0;let[c,$]=[u.channelId,u.messageId];l({id:d,state:"loading",sliderIndex:"0",duration:0,messageId:o,channelId:a}),s(c,$),O(Buffer.from(m,"base64").toString("ascii")).then(function(p){let[,{duration:C}]=p;l({state:"playing",duration:C,time:{l:+Date.now(),t:0}}),f.play(4259920),M=!1,s(a,o)})}else t==="200"?(l({state:"paused"}),f.pause(4259920),s(a,o)):t==="100"?(l({state:"playing"}),f.play(4259920),s(a,o)):(console.log("Index",t),console.log(u.duration/20*parseInt(t)),l({state:"playing",sliderIndex:t,time:{l:+Date.now(),t:u.duration/20*parseInt(t)}}),f.setCurrentTime(4259920,u.duration/20*parseInt(t)),s(a,o));return s(a,o),new Promise(function(c){return c(void 0)})}return e(...i)});return function(){n(),g&&f.release(4259920)}}function L(){let n=0,i=setInterval(function(){let e=S();if(e.state!="playing"||!e.time)return;let r=+Date.now()-e.time.l+e.time.t,t=!1;if(n++,n>33&&(n=0),n==33&&(t=!0),r>e.duration){l({state:"untouched",sliderIndex:"0",id:"0"}),s(e.channelId,e.messageId);return}let a=Math.floor(r/e.duration*20).toString(),o=!1;a!=e.sliderIndex&&(o=!0,l({sliderIndex:a})),(t||o)&&(o=!0,l({time:{t:r,l:+Date.now()}})),o&&s(e.channelId,e.messageId)},1e3/30);return function(){return clearInterval(i)}}let h=[];var k={onLoad:function(){h.push(R()),h.push(j()),h.push(L())},onUnload:function(){for(const n of h)n()}};return y.default=k,Object.defineProperty(y,"__esModule",{value:!0}),y})({},vendetta.metro,vendetta.patcher,vendetta.metro.common);
