(function(y,D,A,x){"use strict";const b=4259920+Math.floor(Math.random()*4089)+8;let w={id:"0",state:"untouched",sliderIndex:"0",duration:0,channelId:"0",messageId:"0"};function S(){return w}function u(n){w={...w,...n}}function E(n){const i=Math.floor(n/1e3),e=String(Math.floor(i/60)).padStart(2,"0"),r=String(i%60).padStart(2,"0");return`${e}:${r}`}function s(n,i){let e={channelId:n,messageId:i,userId:"4259920",emoji:{name:"update",id:"4259920"},burst:!1,colors:void 0,messageAuthorId:void 0};x.FluxDispatcher.dispatch({...e,type:"MESSAGE_REACTION_ADD"}),x.FluxDispatcher.dispatch({...e,type:"MESSAGE_REACTION_REMOVE"})}const _={type:"rich",spoiler:"",provider:void 0,author:void 0,rawTitle:void 0,title:void 0,url:void 0,rawDescription:"",description:[{content:"",type:"text"}],thumbnail:void 0,image:void 0,images:void 0,fields:[],footer:void 0,video:void 0,borderLeftColor:-14803166,providerColor:-3880498,headerTextColor:-4867391,bodyTextColor:-2367775,referenceId:void 0,backgroundColor:void 0},N=D.findByName("RowManager"),P=new Set(["mp3","m4a","ogg","wav"]);function B(n,i,e,r,t,o){let a=Buffer.from(t).toString("base64"),f=function(T){let{index:I,content:v}=T;return{type:"link",target:`https://discord.com/channels/${b}/${I}/${i}/${n}/${e}/${a}`,content:[{type:"inlineCode",content:v}]}},l=S(),d=l.id===e,p=d?l.sliderIndex:"0",$=d?l.state==="playing":!1,g=d?l.time?.t:void 0,C=Array.from({length:20}).map(function(T,I){let v="\u25AC";return I.toString()===p&&(v="\u2586"),f({index:I,content:v})}),F=d?[{type:"text",content:l.state+" \u2014 "},{type:"strong",content:[{type:"text",content:E(g??0)}]},{type:"text",content:" / "},{type:"strong",content:[{type:"text",content:E(l.duration)}]},{type:"text",content:`
`}]:[{type:"text",content:`
`}];return{..._,author:{name:r,url:t},description:[{content:[...F,...C,{type:"heading",content:[f($?{index:200,content:"\u0965"}:{index:100,content:"\u25B6"})],level:1}],type:"paragraph"}],footer:{content:o}}}function R(){return A.after("generate",N.prototype,function(n,i){let{message:e}=i;if(!e?.embeds||!e?.attachments?.length)return;let r=[],t=[];e.attachments.forEach(function(o){P.has(o.filename.toLowerCase().split(".").pop())?r.push(B(e.id,e.channelId,o.id,o.filename,o.url,o.size)):t.push(o)}),r.length&&(e.embeds.push(...r),e.attachments=t),e?.reactions?.length&&(e.reactions=e.reactions.filter(function(o){return o.emoji.id!="4259920"}))})}let h=!1;const{DCDSoundManager:c}=x.ReactNative.NativeModules;function O(n){return console.log("Preparing",n),console.log({isAudioPrepared:h}),h&&c.release(4259920),h=!0,new Promise(function(i){return c.prepare(n,"ring_tone",4259920,function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return i(r)})})}let M=!1;function j(){const n=A.instead("default",D.findByName("safeTransitionTo",!1),function(i,e){let r=i[0].split("/");if(r[2]===b.toString()){let[,,,t,o,a,f,l]=r,d=S();if(d.id!=f){if(M)return new Promise(function(g){return g(void 0)});M=!0;let[p,$]=[d.channelId,d.messageId];u({id:f,state:"loading",sliderIndex:"0",duration:0,messageId:a,channelId:o}),s(p,$),O(Buffer.from(l,"base64").toString("ascii")).then(function(g){let[,{duration:C}]=g;u({state:"playing",duration:C,time:{l:+Date.now(),t:0}}),c.play(4259920),M=!1,s(o,a)})}else t==="200"?(u({state:"paused"}),c.pause(4259920),s(o,a)):t==="100"?(u({state:"playing"}),c.play(4259920),s(o,a)):(console.log("Index",t),console.log(d.duration/20*parseInt(t)),u({state:"playing",sliderIndex:t,time:{l:+Date.now(),t:d.duration/20*parseInt(t)}}),c.setCurrentTime(4259920,d.duration/20*parseInt(t)),s(o,a));return s(o,a),new Promise(function(p){return p(void 0)})}return e(...i)});return function(){n(),h&&c.release(4259920)}}function L(){let n=0,i=setInterval(function(){let e=S();if(e.state!="playing"||!e.time)return;let r=+Date.now()-e.time.l+e.time.t,t=!1;if(n++,n>33&&(n=0),n==33&&(t=!0),r>e.duration){u({state:"untouched",sliderIndex:"0",id:"0"}),s(e.channelId,e.messageId);return}let o=Math.floor(r/e.duration*20).toString(),a=!1;o!=e.sliderIndex&&(a=!0,u({sliderIndex:o})),(t||a)&&(a=!0,u({time:{t:r,l:+Date.now()}})),a&&s(e.channelId,e.messageId)},1e3/30);return function(){return clearInterval(i)}}let m=[];var k={onLoad:function(){m.push(R()),m.push(j()),m.push(L())},onUnload:function(){for(const n of m)n()}};return y.default=k,Object.defineProperty(y,"__esModule",{value:!0}),y})({},vendetta.metro,vendetta.patcher,vendetta.metro.common);
