(function(E,i,r,e,S,u,_,b,H,G,$){"use strict";const{Pressable:V}=u.General,{getPrivateChannelRowHeight:K}=r.findByProps("getPrivateChannelRowHeightWithoutPadding"),L=r.findByName("CategoryChannel"),F=r.findByStoreName("UserGuildSettingsStore"),U=r.findByStoreName("ReadStateStore"),W=r.findByName("FastList"),{getPrivateChannelIds:q}=r.findByProps("getPrivateChannelIds"),{getChannelId:J}=r.findByStoreName("SelectedChannelStore");function x(n){if(!(n.addChangeListener||n.addChangeListener))throw new Error("Invalid store provided.");const[,a]=e.React.useReducer(function(t){return~t},0);return e.React.useEffect(function(){const t=function(){return a()};return n.addChangeListener(t),function(){return void n.removeChangeListener(t)}},[]),null}function Q(){let n=[],a=!1;return n.push(S.after("default",r.findByName("ConnectedPrivateChannels",!1),function(t,p){if(a)return;a=!0;function h(f){let{id:s,selected:c}=f;const P=U.hasUnread(s),g=F.isChannelMuted(null,s);return!(c||P&&!g)}n.push(S.after("render",p.type.prototype,function(f,s){if(!s.props?.children?.props?.children)return;const c=s.props.children.props.children;function P(Pe){let{comp:Ce}=Pe;_.useProxy(i.storage),x(U),x(F);const C=Ce,D=i.storage.pinnedDMs;function Se(){const d={categories:1+D.length,channels:0,collapsedChannels:0},l=Object.fromEntries(Object.values(D).map(function(o){return[o.id,{channels:[],collapsed:i.storage.collapsedPinnedDMs.includes(o.id)}]}));return q().forEach(function(o,m){let B=D.find(function(R){return R.ids.includes(o)});if(!B)return;d.channels+=1;let y=l[B.id];const w=h({id:o,selected:J()===o});y.collapsed&&w&&(d.collapsedChannels+=1),y.channels.push({id:o,shouldHideIfCategoryIsCollapsed:w,index:m})}),{counts:d,categories:l}}const{counts:M,categories:A}=Se();function ve(d,l){l?i.storage.collapsedPinnedDMs.includes(d)||(i.storage.collapsedPinnedDMs=[...i.storage.collapsedPinnedDMs,d]):i.storage.collapsedPinnedDMs=i.storage.collapsedPinnedDMs.filter(function(o){return o!=d})}function De(d,l){return d===0?e.React.createElement(u.ErrorBoundary,null,e.React.createElement(e.React.Fragment,null,Object.entries(A).map(function(o){let[m,{channels:B,collapsed:y}]=o;const w=D.find(function(R){return R.id===m});return e.React.createElement(e.React.Fragment,null,e.React.createElement(V,{onPress:function(){return ve(m,!y)}},e.React.createElement(L,{name:w.name,collapsed:y})),B.map(function(R){const N=C.props.renderItem(0,R.index);if(!y)return N;const{selected:Be}=N.props;return h({id:R.id,selected:Be})?null:N}))}),e.React.createElement(L,{name:"Direct Messages",renderChevron:!1}))):Object.values(A).map(function(o){return o.channels}).flat().some(function(o){return o.index===l})?null:C.props.renderItem(d,l)}function me(d,l){return d===0?32*M.categories+K(1)*(M.channels-M.collapsedChannels):Object.values(A).map(function(o){return o.channels}).flat().some(function(o){return o.index===l})?0:C.props.itemSize(d,l)}return e.React.createElement(W,{...C.props,sections:[1,C.props.sections[0]-0],renderItem:De,itemSize:me,onScroll:function(){}})}const g=e.React.memo(P);c[2]=e.React.createElement(g,{comp:c[2]})}))})),function(){return n.forEach(function(t){return t()})}}const{fromTimestamp:Y}=r.findByProps("extractTimestamp"),O={pin:function(n,a){const t=i.storage.pinnedDMs.findIndex(function(p){return p.id===a});i.storage.pinnedDMs[t].ids=[...i.storage.pinnedDMs[t].ids,n]},unpin:function(n){const a=i.storage.pinnedDMs.findIndex(function(t){return t.ids.includes(n)});i.storage.pinnedDMs[a]={...i.storage.pinnedDMs[a],ids:i.storage.pinnedDMs[a].ids.filter(function(t){return t!=n})}},isPinned:function(n){return i.storage.pinnedDMs.some(function(a){return a.ids.includes(n)})},getPinnedDMs:function(){return i.storage.pinnedDMs},createCategory:function(n){i.storage.pinnedDMs.push({ids:[],id:Y(+Date.now()),name:n})},deleteCategory:function(n){i.storage.pinnedDMs=i.storage.pinnedDMs.filter(function(a){return a.id!=n})}},T=r.findByProps("openLazy","hideActionSheet"),j=r.findByProps("ActionSheet")?.ActionSheet??r.find(function(n){return n.render?.name==="ActionSheet"}),{BottomSheetScrollView:we,BottomSheetFlatList:X}=r.findByProps("BottomSheetScrollView"),{ActionSheetTitleHeader:Z,ActionSheetCloseButton:ee,ActionSheetRow:ne}=r.findByProps("ActionSheetTitleHeader"),v=ne??u.Forms.FormRow;function te(n,a){j?T?.openLazy(new Promise(function(t){return t({default:n})}),"ActionSheet",a):G.showToast("You cannot open ActionSheets on this version! Upgrade to 163+")}const{View:k}=u.General,re=r.findByStoreName("ThemeStore"),ie=r.findByName("ConnectedKeyboardAwareView"),{meta:{resolveSemanticColor:ae}}=r.findByProps("colors","meta"),{useOrientationSettling:se}=r.findByProps("useOrientation"),oe=r.findByProps("pushModal");function ce(){oe.pushModal({key:"pin-dms-new",modal:{key:"pin-dms-new",modal:de,animation:"slide-up",shouldPersistUnderModals:!1,closable:!0}})}function de(){se();const n=e.ReactNative.Dimensions?.get("window").width;return e.React.createElement(k,{style:{flex:1,backgroundColor:"#000000b3",justifyContent:"center",alignItems:"center"}},e.React.createElement(ie,null,e.React.createElement(k,{style:{borderRadius:8,backgroundColor:ae(re.theme,$.semanticColors.BACKGROUND_ACCENT),width:n*.9}},e.React.createElement(u.Forms.FormTitle,{title:"aaaaaa"}))))}const le=r.findByStoreName("ChannelStore"),{getUserAvatarURL:ue,getChannelIconURL:fe}=r.findByProps("getUserAvatarURL","getChannelIconURL"),pe=r.findByStoreName("RelationshipStore"),{computeChannelName:he}=r.findByProps("computeChannelName");function ge(n){let{channelId:a}=n;const t=le.getChannel(a),p=t.type==3?he(t):pe.getNickname(t.recipients[0])??t.rawRecipients[0].global_name;if(t.type!=1&&t.type!=3)return;function h(){if(t.type==1){const s=t.rawRecipients[0],c=ue(s,!1,50);return s.avatar?{uri:c}:c}else{const{id:s,icon:c,applicationId:P}=t,g=fe({id:s,icon:c,applicationId:P,size:32});return c?{uri:g}:g}}const f=[...O.getPinnedDMs().map(function(s){return{id:s.id,label:s.name,icon:null,onPress:function(){return null}}}),{id:"add",label:"New Category",icon:b.getAssetIDByName("ic_add_24px"),onPress:ce}];return e.React.createElement(j,null,e.React.createElement(Z,{title:`Pinning ${p}`,leading:e.React.createElement(e.ReactNative.Image,{source:h(),style:{width:24,height:24,borderRadius:12,marginRight:12}}),trailing:e.React.createElement(ee,{onPress:function(){return T.hideActionSheet()}})}),e.React.createElement(u.Forms.FormTitle,{title:"Add to category"}),e.React.createElement(X,{style:{flex:1},contentContainerStyle:{paddingBottom:48,marginBottom:8},data:f,renderItem:function(s){let{item:c}=s;return e.React.createElement(v,{label:c.label,onPress:c.onPress,icon:e.React.createElement(v.Icon,{source:c.icon,IconComponent:function(){return e.React.createElement(u.Forms.FormIcon,{source:c.icon})}})})},ItemSeparatorComponent:null,keyExtractor:function(s){return s.id}}))}const z=b.getAssetIDByName("icon-pins");function ye(){return S.after("default",r.findByName("ChannelLongPressActionSheet",!1),function(n,a){let[t]=n;S.after("type",a,function(p,h){const f=H.findInReactTree(h,function(s){return s.key==="dm"})?.props?.children;f&&f.push(e.React.createElement(v,{label:"Pin DM",icon:e.React.createElement(v.Icon,{source:z,IconComponent:function(){return e.React.createElement(u.Forms.FormIcon,{source:z})}}),onPress:function(){return te(ge,{channelId:t.channelId})}}))})})}let I=[];var Re={onLoad:function(){i.storage.pinnedDMs??=[{id:"default",name:"Pinned DMs",ids:[]}],I.push(Q()),I.push(ye()),Object.defineProperty(window,"PinDMsDevApi",{configurable:!0,value:O})},onUnload:function(){for(const n of I)n(),delete window.PinDMsDevApi}};return E.default=Re,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.storage,vendetta.ui.assets,vendetta.utils,vendetta.ui.toasts,vendetta.ui);
