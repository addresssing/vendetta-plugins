(function(M,n,o,i,g,f,z,T,U,H){"use strict";const{Pressable:G}=f.General,{getPrivateChannelRowHeight:_}=o.findByProps("getPrivateChannelRowHeightWithoutPadding"),b=o.findByName("CategoryChannel"),L=o.findByStoreName("UserGuildSettingsStore"),F=o.findByStoreName("ReadStateStore"),$=o.findByName("FastList"),{getPrivateChannelIds:k}=o.findByProps("getPrivateChannelIds"),{getChannelId:V}=o.findByStoreName("SelectedChannelStore");function N(e){if(!(e.addChangeListener||e.addChangeListener))throw new Error("Invalid store provided.");const[,t]=i.React.useReducer(function(s){return~s},0);return i.React.useEffect(function(){const s=function(){return t()};return e.addChangeListener(s),function(){return void e.removeChangeListener(s)}},[]),null}function W(){let e=[],t=!1;return e.push(g.after("default",o.findByName("ConnectedPrivateChannels",!1),function(s,P){if(t)return;t=!0;function y(h){let{id:d,selected:D}=h;const E=F.hasUnread(d),I=L.isChannelMuted(null,d);return!(D||E&&!I)}e.push(g.after("render",P.type.prototype,function(h,d){if(!d.props?.children?.props?.children)return;const D=d.props.children.props.children;function E(ne){let{comp:te}=ne;z.useProxy(n.storage),N(F),N(L);const p=te,v=n.storage.pinnedDMs;function re(){const a={categories:1+v.length,channels:0,collapsedChannels:0},c=Object.fromEntries(Object.values(v).map(function(r){return[r.id,{channels:[],collapsed:n.storage.collapsedPinnedDMs.includes(r.id)}]}));return k().forEach(function(r,S){let R=v.find(function(l){return l.ids.includes(r)});if(!R)return;a.channels+=1;let u=c[R.id];const C=y({id:r,selected:V()===r});u.collapsed&&C&&(a.collapsedChannels+=1),u.channels.push({id:r,shouldHideIfCategoryIsCollapsed:C,index:S})}),{counts:a,categories:c}}const{counts:B,categories:w}=re();function se(a,c){c?n.storage.collapsedPinnedDMs.includes(a)||(n.storage.collapsedPinnedDMs=[...n.storage.collapsedPinnedDMs,a]):n.storage.collapsedPinnedDMs=n.storage.collapsedPinnedDMs.filter(function(r){return r!=a})}function ie(a,c){return a===0?i.React.createElement(f.ErrorBoundary,null,i.React.createElement(i.React.Fragment,null,Object.entries(w).map(function(r){let[S,{channels:R,collapsed:u}]=r;const C=v.find(function(l){return l.id===S});return i.React.createElement(i.React.Fragment,null,i.React.createElement(G,{onPress:function(){return se(S,!u)}},i.React.createElement(b,{name:C.name,collapsed:u})),R.map(function(l){const A=p.props.renderItem(0,l.index);if(!u)return A;const{selected:ae}=A.props;return y({id:l.id,selected:ae})?null:A}))}),i.React.createElement(b,{name:"Direct Messages",renderChevron:!1}))):Object.values(w).map(function(r){return r.channels}).flat().some(function(r){return r.index===c})?null:p.props.renderItem(a,c)}function oe(a,c){return a===0?32*B.categories+_(1)*(B.channels-B.collapsedChannels):Object.values(w).map(function(r){return r.channels}).flat().some(function(r){return r.index===c})?0:p.props.itemSize(a,c)}return i.React.createElement($,{...p.props,sections:[1,p.props.sections[0]-0],renderItem:ie,itemSize:oe,onScroll:function(){}})}const I=i.React.memo(E);D[2]=i.React.createElement(I,{comp:D[2]})}))})),function(){return e.forEach(function(s){return s()})}}const q=o.findByProps("openLazy","hideActionSheet"),j=o.findByProps("ActionSheet")?.ActionSheet??o.find(function(e){return e.render?.name==="ActionSheet"}),{BottomSheetScrollView:J}=o.findByProps("BottomSheetScrollView");function K(e,t){j?q?.openLazy(new Promise(function(s){return s({default:e})}),"ActionSheet",t):H.showToast("You cannot open ActionSheets on this version! Upgrade to 163+")}function Q(e){let{channelId:t}=e;return React.createElement(j,null,React.createElement(J,null,React.createElement(f.Forms.FormText,null,t)))}const x=o.findByProps("ActionSheetRow")?.ActionSheetRow??f.Forms.FormRow,O=T.getAssetIDByName("icon-pins");function Y(){return g.after("default",o.findByName("ChannelLongPressActionSheet",!1),function(e,t){let[s]=e;g.after("type",t,function(P,y){const h=U.findInReactTree(y,function(d){return d.key==="dm"})?.props?.children;h&&h.push(i.React.createElement(x,{label:"Pin DM",icon:i.React.createElement(x.Icon,{source:O,IconComponent:function(){return i.React.createElement(f.Forms.FormIcon,{source:O})}}),onPress:function(){return K(Q,{channelId:s.channelId})}}))})})}const{fromTimestamp:X}=o.findByProps("extractTimestamp"),Z={pin:function(e,t){const s=n.storage.pinnedDMs.findIndex(function(P){return P.id===t});n.storage.pinnedDMs[s].ids=[...n.storage.pinnedDMs[s].ids,e]},unpin:function(e){const t=n.storage.pinnedDMs.findIndex(function(s){return s.ids.includes(e)});n.storage.pinnedDMs[t]={...n.storage.pinnedDMs[t],ids:n.storage.pinnedDMs[t].ids.filter(function(s){return s!=e})}},isPinned:function(e){return n.storage.pinnedDMs.some(function(t){return t.ids.includes(e)})},getPinnedDMs:function(){return n.storage.pinnedDMs},createCategory:function(e){n.storage.pinnedDMs.push({ids:[],id:X(+Date.now()),name:e})},deleteCategory:function(e){n.storage.pinnedDMs=n.storage.pinnedDMs.filter(function(t){return t.id!=e})}};let m=[];var ee={onLoad:function(){n.storage.pinnedDMs??=[],m.push(W()),m.push(Y()),Object.defineProperty(window,"PinDMsDevApi",{configurable:!0,value:Z})},onUnload:function(){for(const e of m)e(),delete window.PinDMsDevApi}};return M.default=ee,Object.defineProperty(M,"__esModule",{value:!0}),M})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.storage,vendetta.ui.assets,vendetta.utils,vendetta.ui.toasts);
