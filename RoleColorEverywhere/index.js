(function(g,l,p,t,C,N,i,u,T,M){"use strict";const{Text:I}=C.General,w=t.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:B}}=t.findByProps("colors","meta"),D=t.findByStoreName("UserStore"),_=t.findByStoreName("RelationshipStore"),P=t.findByStoreName("GuildMemberStore"),R=t.findByProps("TYPING_WRAPPER_HEIGHT");function O(){return p.after("default",R,function(e,s){let[{channel:r}]=e;if(!s||i.storage.hideTyping)return;const n=s.props?.children,h=B(w.theme,N.semanticColors.HEADER_SECONDARY),c=p.after("type",n,function(E,y){l.React.useEffect(function(){return function(){c()}},[]);const d=y?.props?.children?.[0]?.props?.children?.[1]?.props;if(!d||!d.children||d.children==="Several people are typing...")return;const o=R.useTypingUserIds(r.id).map(function(a){const f=P.getMember(r.guild_id,a),b=D.getUser(a),Y=f?.nick||_.getNickname(a)||b.globalName||b.username,J=f?.colorString||h;return{displayName:Y,displayColor:J}});function S(a){return l.React.createElement(I,{style:{color:a.displayColor,fontFamily:l.constants.Fonts.DISPLAY_BOLD}},a.displayName)}!o||o.length<1||(d.children=o.length===1?[S(o[0])," is typing..."]:[...o.slice(0,o.length-1).flatMap(function(a,f){return[S(a),f<o.length-2?", ":" and "]}),S(o[o.length-1])," are typing..."])})})}const{DCDChatManager:k}=l.ReactNative.NativeModules,G=t.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:A}}=t.findByProps("colors","meta"),U=t.findByStoreName("GuildMemberStore"),x=t.findByProps("insertText");function F(e,s,r,n){return console.log(e,s,r,n),{content:[{type:"text",content:e}],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"bindUserMenu",userId:s,linkColor:l.ReactNative.processColor(n),messageChannelId:r},medium:!0},type:"link"}}function H(){return p.before("updateRows",k,function(e){if(i.storage.noMention)return;const s=A(G.theme,N.semanticColors.MENTION_FOREGROUND);let r=JSON.parse(e[1]);r.forEach(function(n){if(n.type!=1||!n.message?.content)return;let h=x.refs[0]?.current?.props?.channel;n.message.content.forEach(function(c,E){if(c.type!="mention")return;const y=U.getMember(h.guild_id,c.userId)?.colorString||s;n.message.content[E]=F(c.content[0].content,c.userId,c.channelId,y)})}),e[1]=JSON.stringify(r)})}const v={Typing:M.getAssetIDByName("ic_messages")};function L(){return T.useProxy(i.storage),React.createElement(l.ReactNative.ScrollView,{style:{flex:1}},React.createElement(u.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(u.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(u.FormIcon,{source:v.Typing}),value:!i.storage.hideTyping,onValueChange:function(e){return i.storage.hideTyping=!e}}),React.createElement(View,{style:{marginHorizontal:15}},React.createElement(HelpMessage,{messageType:0},"Enabling show in mentions will remove the background color from mentions due to Discord limitations.")),React.createElement(u.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(u.FormIcon,{source:v.Typing}),value:!i.storage.noMention,onValueChange:function(e){return i.storage.noMention=!e}})))}let m=[];var V={onLoad:function(){m.push(O()),m.push(H())},onUnload:function(){for(const e of m)e()},settings:L};return g.default=V,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
