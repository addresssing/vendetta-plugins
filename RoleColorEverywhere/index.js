(function(B,p,S,u,w,R,a,x,m,L,C){"use strict";const{Text:G}=w.General,V=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:U}}=u.findByProps("colors","meta"),k=u.findByStoreName("UserStore"),$=u.findByStoreName("RelationshipStore"),F=u.findByStoreName("GuildMemberStore"),D=u.findByProps("TYPING_WRAPPER_HEIGHT");function H(){return S.after("default",D,function(e,d){let[{channel:r}]=e;if(!d||a.storage.hideTyping)return;const t=d.props?.children,s=U(V.theme,R.semanticColors.HEADER_SECONDARY),l=S.after("type",t,function(h,g){p.React.useEffect(function(){return function(){l()}},[]);const i=g?.props?.children?.[0]?.props?.children?.[1]?.props;if(!i||!i.children||i.children==="Several people are typing...")return;const n=D.useTypingUserIds(r.id).map(function(o){const c=F.getMember(r.guild_id,o),v=k.getUser(o),y=c?.nick||$.getNickname(o)||v.globalName||v.username,b=c?.colorString||s;return{displayName:y,displayColor:b}});function f(o){return p.React.createElement(G,{style:{color:o.displayColor,fontFamily:p.constants.Fonts.DISPLAY_BOLD}},o.displayName)}!n||n.length<1||(i.children=n.length===1?[f(n[0])," is typing..."]:[...n.slice(0,n.length-1).flatMap(function(o,c){return[f(o),c<n.length-2?", ":" and "]}),f(n[n.length-1])," are typing..."])})})}const j=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:Y}}=u.findByProps("colors","meta"),W=u.findByName("RowManager"),O=u.findByStoreName("GuildMemberStore");u.findByStoreName("SelectedChannelStore");const K=u.findByStoreName("ChannelStore");function I(e,d,r,t){if(e)return t=Object.assign([],t),t?t.push(e):t=[e],Array.isArray(e.content)?e.content.forEach(function(s,l){return e.content[l]=I(s,d,r,t)}):e.items?e.items.forEach(function(s,l){return e.items[l]=I(s,d,r,t)}):Array.isArray(e)&&e.forEach(function(s,l){return e[l]=I(s,d,r,t)}),e.type&&d.forEach(function(s){e=s(e,r,t)||e}),e}function X(e,d,r){const t=function(i){return i.match(/\w\w/g).map(function(n){return parseInt(n,16)})},s=function(i){return"#"+i.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},l=t(e),h=t(d),g=l.map(function(i,n){return Math.round(i+(h[n]-i)*r)});return s(g)}function z(){return S.after("generate",W.prototype,function(e,d){let[r]=e,{message:t}=d;if((!a.storage.chatInterpolation||a.storage.chatInterpolation<=0)&&a.storage.noMention||r.rowType!=1)return;const s=t.channelId,l=K.getChannel(s);if(!l?.guild_id)return;const h=function(f){if(f.type!="mention"||!f.userId)return;const o=O.getMember(l.guild_id,f.userId)?.colorString;if(!o)return;const c=parseInt(o.slice(1),16);return{...f,roleColor:c,color:c,colorString:o}},g=Y(j.theme,R.semanticColors.TEXT_NORMAL),i=function(f,o,c){let[v]=o,y=c?.map(function(T){return T.type});if(y?.includes("mention")||y?.includes("channelMention")||y?.includes("roleMention")||y?.includes("commandMention")||y?.includes("link")||f.type!="text")return;const b=O.getMember(t.guildId,v);if(!(!b||!b.colorString))return{content:[f],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:p.ReactNative.processColor(X(g,b.colorString,a.storage.chatInterpolation/100)),messageChannelId:"0"},medium:!0},type:"link"}};let n=[];a.storage.chatInterpolation>0&&n.push(i),a.storage.noMention||(n.push(h),t.shouldShowRoleOnName=!0),t.content&&I({content:t.content},n,[t.authorId]),t.embeds&&t.embeds.forEach(function(f){return I({content:f.description},n,[t.authorId])}),t.referencedMessage?.message?.content&&I({content:t.referencedMessage.message.content},n,[t.referencedMessage.message.authorId])})}const q=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:Q}}=u.findByProps("colors","meta");function J(){return S.after("default",u.findByName("VoiceUserConnected",!1),function(e,d){let[r]=e;if(a.storage.noVoice)return;const t=S.after("render",d.type.prototype,function(s,l){t();let h=l.props?.children?.[1]?.props;h&&(h.style.color=r?.member?.colorString||Q(q.theme,R.semanticColors.CHANNELS_DEFAULT))})})}const{View:Z}=p.ReactNative,ee=u.findByStoreName("GuildStore");function te(){return S.after("render",Z,function(e,d){if(a.storage.noRole)return;const r=x.findInReactTree(d,function(s){return s?.props?.roleId});if(!r||isNaN(r.props.roleId)||r.props.excludedApplications||r.props.hasOwnProperty("displayRoleIcon")||r.props.hasOwnProperty("searchable"))return;let t={type:Object.assign({},r.type)};S.after("type",t.type,function(s,l){let h={type:Object.assign({},l.props.children[1].type)};S.after("render",h.type,function(g,i){let n=ee.getGuild(r.props.guildId)?.roles?.[r.props.roleId];n?.colorString&&i.props.style.push({color:n.colorString})}),l.props.children[1].type=h.type}),r.type=t.type})}const{StyleSheet:ne,PanResponder:oe}=p.ReactNative,M=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:_}}=u.findByProps("colors","meta"),{View:P}=w.General,{useState:re,useRef:ae}=p.React,A={sliderOff:_(M.theme,R.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:_(M.theme,R.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:_(M.theme,R.semanticColors.MENTION_FOREGROUND)},ie=function(e){let{onSlide:d,value:r}=e;const t=r||0,[s,l]=re(0),h=ae(null);function g(o){h.current&&h.current.measure(function(c,v,y,b,T,ye){let me=(o-T)/(y-T)*100;const ge=Math.min(Math.max(0,me),100);d&&d(ge)})}const i=p.React.useRef(oe.create({onStartShouldSetPanResponder:function(o,c){return!0},onStartShouldSetPanResponderCapture:function(o,c){return!0},onMoveShouldSetPanResponder:function(o,c){return!0},onMoveShouldSetPanResponderCapture:function(o,c){return!0},onPanResponderGrant:function(o,c){g(c.x0)},onPanResponderMove:function(o,c){g(c.moveX)},onPanResponderTerminationRequest:function(o,c){return!0},onPanResponderRelease:function(o,c){},onPanResponderTerminate:function(o,c){},onShouldBlockNativeResponder:function(o,c){return!0}})).current;function n(o){l(o.nativeEvent.layout.width)}const f=ne.create({container:{marginLeft:"5%",width:"90%",height:20,borderRadius:25,backgroundColor:A.sliderOff,marginBottom:25},slid:{width:t+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:t===100?25:0,backgroundColor:A.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(s/2),borderRadius:100,backgroundColor:A.thumb}});return p.React.createElement(P,{style:f.container,...i.panHandlers,ref:h},p.React.createElement(P,{style:f.slid},p.React.createElement(P,{style:f.thumb,onLayout:n})))},{Text:ce,View:se}=w.General,le=u.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:ue}}=u.findByProps("colors","meta"),E={Typing:C.getAssetIDByName("ic_messages"),Mention:C.getAssetIDByName("ic_mention_user"),Text:C.getAssetIDByName("ic_add_text"),Voice:C.getAssetIDByName("ic_voice_channel_24px"),Role:C.getAssetIDByName("ic_person_shield")},de={text:ue(le.theme,R.semanticColors.TEXT_NORMAL)};function fe(e,d,r){const t=function(i){return i.match(/\w\w/g).map(function(n){return parseInt(n,16)})},s=function(i){return"#"+i.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},l=t(e),h=t(d),g=l.map(function(i,n){return Math.round(i+(h[n]-i)*r)});return s(g)}function he(){return L.useProxy(a.storage),a.storage.chatInterpolation??=0,React.createElement(p.ReactNative.ScrollView,{style:{flex:1}},React.createElement(m.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(m.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(m.FormIcon,{source:E.Typing}),value:!a.storage.hideTyping,onValueChange:function(e){return a.storage.hideTyping=!e}}),React.createElement(m.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(m.FormIcon,{source:E.Mention}),value:!a.storage.noMention,onValueChange:function(e){return a.storage.noMention=!e}}),React.createElement(m.FormSwitchRow,{label:"Show in member list",subLabel:"Display the top role color in the member list role section headers.",leading:React.createElement(m.FormIcon,{source:E.Role}),value:!a.storage.noRole,onValueChange:function(e){return a.storage.noRole=!e}}),React.createElement(se,{style:{marginHorizontal:10,marginBottom:2}},React.createElement(w.HelpMessage,{messageType:0},"(Regarding option below) - Limitations cause text coloring to prevent interaction with the text. Instead, you'll have to press anywhere else in the message to open the context menu or use gestures.")),React.createElement(m.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(m.FormIcon,{source:E.Text}),value:a.storage.chatInterpolation>0,onValueChange:function(e){a.storage.chatInterpolation=e?100:0}}),React.createElement(ce,{style:{marginLeft:"5%",color:fe(de.text,"#ff0000",a.storage.chatInterpolation/100),fontFamily:p.constants.Fonts.DISPLAY_MEDIUM,fontSize:16,marginBottom:5,marginTop:-5}},"Color interpolation (for chat text):"),React.createElement(ie,{onSlide:function(e){a.storage.chatInterpolation=e},value:a.storage.chatInterpolation,style:{marginBottom:0}}),React.createElement(m.FormSwitchRow,{label:"Show in voice channel member list",subLabel:"Display the top role color in the voice channel member list.",leading:React.createElement(m.FormIcon,{source:E.Voice}),value:!a.storage.noVoice,onValueChange:function(e){a.storage.noVoice=!e}})))}let N=[];var pe={onLoad:function(){N.push(H()),N.push(z()),N.push(J()),N.push(te())},onUnload:function(){for(const e of N)e()},settings:he};return B.default=pe,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.utils,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
