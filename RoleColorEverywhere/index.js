(function(g,l,m,t,M,N,a,u,T,R){"use strict";const{Text:I}=M.General,_=t.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:B}}=t.findByProps("colors","meta"),D=t.findByStoreName("UserStore"),w=t.findByStoreName("RelationshipStore"),P=t.findByStoreName("GuildMemberStore"),v=t.findByProps("TYPING_WRAPPER_HEIGHT");function O(){return m.after("default",v,function(e,s){let[{channel:r}]=e;if(!s||a.storage.hideTyping)return;const n=s.props?.children,h=B(_.theme,N.semanticColors.HEADER_SECONDARY),c=m.after("type",n,function(b,y){l.React.useEffect(function(){return function(){c()}},[]);const d=y?.props?.children?.[0]?.props?.children?.[1]?.props;if(!d||!d.children||d.children==="Several people are typing...")return;const o=v.useTypingUserIds(r.id).map(function(i){const f=P.getMember(r.guild_id,i),C=D.getUser(i),Y=f?.nick||w.getNickname(i)||C.globalName||C.username,J=f?.colorString||h;return{displayName:Y,displayColor:J}});function S(i){return l.React.createElement(I,{style:{color:i.displayColor,fontFamily:l.constants.Fonts.DISPLAY_BOLD}},i.displayName)}!o||o.length<1||(d.children=o.length===1?[S(o[0])," is typing..."]:[...o.slice(0,o.length-1).flatMap(function(i,f){return[S(i),f<o.length-2?", ":" and "]}),S(o[o.length-1])," are typing..."])})})}const{DCDChatManager:k}=l.ReactNative.NativeModules,A=t.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:G}}=t.findByProps("colors","meta"),U=t.findByStoreName("GuildMemberStore"),x=t.findByProps("insertText");function F(e,s,r,n){return console.log(e,s,r,n),{content:[{type:"text",content:e}],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"bindUserMenu",userId:s,linkColor:l.ReactNative.processColor(n),messageChannelId:r},medium:!0},type:"link"}}function H(){return m.before("updateRows",k,function(e){if(a.storage.noMention)return;const s=G(A.theme,N.semanticColors.MENTION_FOREGROUND);let r=JSON.parse(e[1]);r.forEach(function(n){if(n.type!=1||!n.message?.content)return;let h=x.refs[0]?.current?.props?.channel;n.message.content.forEach(function(c,b){if(c.type!="mention")return;const y=U.getMember(h.guild_id,c.userId)?.colorString||s;n.message.content[b]=F(c.content[0].content,c.userId,c.channelId,y)})}),e[1]=JSON.stringify(r)})}const E={Typing:R.getAssetIDByName("ic_messages"),Mention:R.getAssetIDByName("ic_mention_user")};function L(){return T.useProxy(a.storage),React.createElement(l.ReactNative.ScrollView,{style:{flex:1}},React.createElement(u.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(u.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(u.FormIcon,{source:E.Typing}),value:!a.storage.hideTyping,onValueChange:function(e){return a.storage.hideTyping=!e}}),React.createElement(View,{style:{marginHorizontal:15}},React.createElement(HelpMessage,{messageType:0},"Enabling show in mentions will remove the background color from mentions due to Discord limitations.")),React.createElement(u.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(u.FormIcon,{source:E.Mention}),value:!a.storage.noMention,onValueChange:function(e){return a.storage.noMention=!e}})))}let p=[];var V={onLoad:function(){p.push(O()),p.push(H())},onUnload:function(){for(const e of p)e()},settings:L};return g.default=V,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
