(function(h,l,m,o,_,T,a,u,I,R){"use strict";const{Text:B}=_.General,C=o.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:D}}=o.findByProps("colors","meta"),P=o.findByStoreName("UserStore"),w=o.findByStoreName("RelationshipStore"),A=o.findByStoreName("GuildMemberStore"),M=o.findByProps("TYPING_WRAPPER_HEIGHT");function G(){return m.after("default",M,function(e,r){let[{channel:t}]=e;if(!r||a.storage.hideTyping)return;const s=r.props?.children,d=D(C.theme,T.semanticColors.HEADER_SECONDARY),c=m.after("type",s,function(f,g){l.React.useEffect(function(){return function(){c()}},[]);const p=g?.props?.children?.[0]?.props?.children?.[1]?.props;if(!p||!p.children||p.children==="Several people are typing...")return;const n=M.useTypingUserIds(t.id).map(function(i){const y=A.getMember(t.guild_id,i),E=P.getUser(i),V=y?.nick||w.getNickname(i)||E.globalName||E.username,Y=y?.colorString||d;return{displayName:V,displayColor:Y}});function N(i){return l.React.createElement(B,{style:{color:i.displayColor,fontFamily:l.constants.Fonts.DISPLAY_BOLD}},i.displayName)}!n||n.length<1||(p.children=n.length===1?[N(n[0])," is typing..."]:[...n.slice(0,n.length-1).flatMap(function(i,y){return[N(i),y<n.length-2?", ":" and "]}),N(n[n.length-1])," are typing..."])})})}const{DCDChatManager:L}=l.ReactNative.NativeModules,O=o.findByStoreName("GuildMemberStore"),F=o.findByProps("insertText");function S(e,r){if(e)return Array.isArray(e.content)&&e.content.forEach(function(t,s){return e.content[s]=S(t,r)}),e.type&&(e=r(e)||e),e}function U(){return m.before("updateRows",L,function(e){if(a.storage.noMention)return;let r=JSON.parse(e[1]);r.forEach(function(t){if(t.type!=1||!t.message?.content)return;let s=F.refs[0]?.current?.props?.channel;if(!s||!s.guild_id)return;const d=function(c){if(c.type!="mention"||!c.userId)return;const f=O.getMember(s.guild_id,c.userId)?.colorString;if(!f)return;const g=parseInt(f.slice(1),16);return{...c,roleColor:g,color:g,colorString:f}};S({content:t.message.content},d),t.message.referencedMessage?.message?.content&&S({content:t.message.referencedMessage.message.content},d)}),e[1]=JSON.stringify(r)})}const b={Typing:R.getAssetIDByName("ic_messages"),Mention:R.getAssetIDByName("ic_mention_user")};function x(){return I.useProxy(a.storage),React.createElement(l.ReactNative.ScrollView,{style:{flex:1}},React.createElement(u.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(u.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(u.FormIcon,{source:b.Typing}),value:!a.storage.hideTyping,onValueChange:function(e){return a.storage.hideTyping=!e}}),React.createElement(u.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(u.FormIcon,{source:b.Mention}),value:!a.storage.noMention,onValueChange:function(e){return a.storage.noMention=!e}})))}let v=[];var H={onLoad:function(){v.push(G()),v.push(U())},onUnload:function(){for(const e of v)e()},settings:x};return h.default=H,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
