(function(B,m,C,l,E,S,c,g,L,b){"use strict";const{Text:G}=E.General,V=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:U}}=l.findByProps("colors","meta"),k=l.findByStoreName("UserStore"),$=l.findByStoreName("RelationshipStore"),F=l.findByStoreName("GuildMemberStore"),D=l.findByProps("TYPING_WRAPPER_HEIGHT");function H(){return C.after("default",D,function(e,r){let[{channel:s}]=e;if(!r||c.storage.hideTyping)return;const t=r.props?.children,u=U(V.theme,S.semanticColors.HEADER_SECONDARY),d=C.after("type",t,function(h,p){m.React.useEffect(function(){return function(){d()}},[]);const a=p?.props?.children?.[0]?.props?.children?.[1]?.props;if(!a||!a.children||a.children==="Several people are typing...")return;const n=D.useTypingUserIds(s.id).map(function(o){const i=F.getMember(s.guild_id,o),v=k.getUser(o),y=i?.nick||$.getNickname(o)||v.globalName||v.username,R=i?.colorString||u;return{displayName:y,displayColor:R}});function f(o){return m.React.createElement(G,{style:{color:o.displayColor,fontFamily:m.constants.Fonts.DISPLAY_BOLD}},o.displayName)}!n||n.length<1||(a.children=n.length===1?[f(n[0])," is typing..."]:[...n.slice(0,n.length-1).flatMap(function(o,i){return[f(o),i<n.length-2?", ":" and "]}),f(n[n.length-1])," are typing..."])})})}const j=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:Y}}=l.findByProps("colors","meta"),W=l.findByName("RowManager"),O=l.findByStoreName("GuildMemberStore");l.findByStoreName("SelectedChannelStore");const K=l.findByStoreName("ChannelStore");function I(e,r,s,t){if(e)return t=Object.assign([],t),t?t.push(e):t=[e],Array.isArray(e.content)?e.content.forEach(function(u,d){return e.content[d]=I(u,r,s,t)}):e.items?e.items.forEach(function(u,d){return e.items[d]=I(u,r,s,t)}):Array.isArray(e)&&e.forEach(function(u,d){return e[d]=I(u,r,s,t)}),e.type&&r.forEach(function(u){e=u(e,s,t)||e}),e}function X(e,r,s){const t=function(a){return a.match(/\w\w/g).map(function(n){return parseInt(n,16)})},u=function(a){return"#"+a.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},d=t(e),h=t(r),p=d.map(function(a,n){return Math.round(a+(h[n]-a)*s)});return u(p)}function z(){return C.after("generate",W.prototype,function(e,r){let[s]=e,{message:t}=r;if((!c.storage.chatInterpolation||c.storage.chatInterpolation<=0)&&c.storage.noMention||s.rowType!=1||!t?.content)return;const u=t.channelId,d=K.getChannel(u);if(!d?.guild_id)return;const h=function(f){if(f.type!="mention"||!f.userId)return;const o=O.getMember(d.guild_id,f.userId)?.colorString;if(!o)return;const i=parseInt(o.slice(1),16);return{...f,roleColor:i,color:i,colorString:o}},p=Y(j.theme,S.semanticColors.TEXT_NORMAL),a=function(f,o,i){let[v]=o,y=i?.map(function(T){return T.type});if(y?.includes("mention")||y?.includes("channelMention")||y?.includes("roleMention")||y?.includes("commandMention")||y?.includes("link")||f.type!="text")return;const R=O.getMember(t.guildId,v);if(!(!R||!R.colorString))return{content:[f],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:m.ReactNative.processColor(X(p,R.colorString,c.storage.chatInterpolation/100)),messageChannelId:"0"},medium:!0},type:"link"}};let n=[];c.storage.chatInterpolation>0&&n.push(a),c.storage.noMention||n.push(h),I({content:t.content},n,[t.authorId]),t.referencedMessage?.message?.content&&I({content:t.referencedMessage.message.content},n,[t.referencedMessage.message.authorId])})}const q=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:Q}}=l.findByProps("colors","meta");function J(){return C.after("default",l.findByName("VoiceUserConnected",!1),function(e,r){let[s]=e;if(c.storage.noVoice)return;const t=C.after("render",r.type.prototype,function(u,d){t();let h=d.props?.children?.[1]?.props;h&&(h.style.color=s?.member?.colorString||Q(q.theme,S.semanticColors.CHANNELS_DEFAULT))})})}function _(){return _=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},_.apply(this,arguments)}function Z(){return _.apply(this,arguments)}const{StyleSheet:ee,PanResponder:te}=m.ReactNative,w=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:P}}=l.findByProps("colors","meta"),{View:x}=E.General,{useState:ne,useRef:oe}=m.React,A={sliderOff:P(w.theme,S.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:P(w.theme,S.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:P(w.theme,S.semanticColors.MENTION_FOREGROUND)},re=function(e){let{onSlide:r,value:s}=e;const t=s||0,[u,d]=ne(0),h=oe(null);function p(o){h.current&&h.current.measure(function(i,v,y,R,T,pe){let he=(o-T)/(y-T)*100;const me=Math.min(Math.max(0,he),100);r&&r(me)})}const a=m.React.useRef(te.create({onStartShouldSetPanResponder:function(o,i){return!0},onStartShouldSetPanResponderCapture:function(o,i){return!0},onMoveShouldSetPanResponder:function(o,i){return!0},onMoveShouldSetPanResponderCapture:function(o,i){return!0},onPanResponderGrant:function(o,i){p(i.x0)},onPanResponderMove:function(o,i){p(i.moveX)},onPanResponderTerminationRequest:function(o,i){return!0},onPanResponderRelease:function(o,i){},onPanResponderTerminate:function(o,i){},onShouldBlockNativeResponder:function(o,i){return!0}})).current;function n(o){d(o.nativeEvent.layout.width)}const f=ee.create({container:{marginLeft:"5%",width:"90%",height:20,borderRadius:25,backgroundColor:A.sliderOff,marginBottom:25},slid:{width:t+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:t===100?25:0,backgroundColor:A.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(u/2),borderRadius:100,backgroundColor:A.thumb}});return m.React.createElement(x,Z({style:f.container},a.panHandlers,{ref:h}),m.React.createElement(x,{style:f.slid},m.React.createElement(x,{style:f.thumb,onLayout:n})))},{Text:ae,View:ie}=E.General,ce=l.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:se}}=l.findByProps("colors","meta"),N={Typing:b.getAssetIDByName("ic_messages"),Mention:b.getAssetIDByName("ic_mention_user"),Text:b.getAssetIDByName("ic_add_text"),Voice:b.getAssetIDByName("ic_voice_channel_24px")},le={text:se(ce.theme,S.semanticColors.TEXT_NORMAL)};function ue(e,r,s){const t=function(a){return a.match(/\w\w/g).map(function(n){return parseInt(n,16)})},u=function(a){return"#"+a.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},d=t(e),h=t(r),p=d.map(function(a,n){return Math.round(a+(h[n]-a)*s)});return u(p)}function de(){return L.useProxy(c.storage),c.storage.chatInterpolation??=0,React.createElement(m.ReactNative.ScrollView,{style:{flex:1}},React.createElement(g.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(g.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(g.FormIcon,{source:N.Typing}),value:!c.storage.hideTyping,onValueChange:function(e){return c.storage.hideTyping=!e}}),React.createElement(g.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(g.FormIcon,{source:N.Mention}),value:!c.storage.noMention,onValueChange:function(e){return c.storage.noMention=!e}}),React.createElement(ie,{style:{marginHorizontal:10,marginBottom:2}},React.createElement(E.HelpMessage,{messageType:0},"(Regarding option below) - Limitations cause text coloring to prevent interaction with the text. Instead, you'll have to press anywhere else in the message to open the context menu or use gestures.")),React.createElement(g.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(g.FormIcon,{source:N.Text}),value:c.storage.chatInterpolation>0,onValueChange:function(e){c.storage.chatInterpolation=e?100:0}}),React.createElement(ae,{style:{marginLeft:"5%",color:ue(le.text,"#ff0000",c.storage.chatInterpolation/100),fontFamily:m.constants.Fonts.DISPLAY_MEDIUM,fontSize:16,marginBottom:5,marginTop:-5}},"Color interpolation (for chat text):"),React.createElement(re,{onSlide:function(e){c.storage.chatInterpolation=e},value:c.storage.chatInterpolation,style:{marginBottom:0}}),React.createElement(g.FormSwitchRow,{label:"Show in voice channel member list",subLabel:"Display the top role color in the voice channel member list.",leading:React.createElement(g.FormIcon,{source:N.Voice}),value:!c.storage.noVoice,onValueChange:function(e){c.storage.noVoice=!e}})))}let M=[];var fe={onLoad:function(){M.push(H()),M.push(z()),M.push(J())},onUnload:function(){for(const e of M)e()},settings:de};return B.default=fe,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
