(function(E,m,g,c,b,S,l,L,p,$,v){"use strict";const{Text:G}=b.General,V=c.findByStoreName("ThemeStore"),U=c.find(function(e){return e.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??c.find(function(e){return e.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},k=c.findByStoreName("UserStore"),F=c.findByStoreName("RelationshipStore"),H=c.findByStoreName("GuildMemberStore"),D=c.findByProps("TYPING_WRAPPER_HEIGHT");function j(){return g.after("default",D,function(e,t){let[{channel:o}]=e;if(!t||l.storage.hideTyping)return;const r=t.props?.children,s=U(V.theme,S.semanticColors.HEADER_SECONDARY),f=g.after("type",r,function(h,u){m.React.useEffect(function(){return function(){f()}},[]);const a=u?.props?.children?.[0]?.props?.children?.[1]?.props;if(!a||!a.children||a.children==="Several people are typing...")return;const n=D.useTypingUserIds(o.id).map(function(i){const d=H.getMember(o.guild_id,i),N=k.getUser(i),B=d?.nick||F.getNickname(i)||N.globalName||N.username,P=d?.colorString||s;return{displayName:B,displayColor:P}});function y(i){return m.React.createElement(G,{style:{color:i.displayColor,fontFamily:m.constants.Fonts.DISPLAY_SEMIBOLD}},i.displayName)}!n||n.length<1||(a.children=n.length===1?[y(n[0])," is typing..."]:[...n.slice(0,n.length-1).flatMap(function(i,d){return[y(i),d<n.length-2?", ":" and "]}),y(n[n.length-1])," are typing..."])})})}const Y=c.findByStoreName("ThemeStore"),W=c.find(function(e){return e.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??c.find(function(e){return e.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},K=c.findByName("RowManager"),O=c.findByStoreName("GuildMemberStore"),X=c.findByStoreName("ChannelStore");function R(e,t,o,r){if(e)return r=Object.assign([],r),r?r.push(e):r=[e],Array.isArray(e.content)?e.content.forEach(function(s,f){return e.content[f]=R(s,t,o,r)}):e.items?e.items.forEach(function(s,f){return e.items[f]=R(s,t,o,r)}):Array.isArray(e)&&e.forEach(function(s,f){return e[f]=R(s,t,o,r)}),e.type&&t.forEach(function(s){e=s(e,o,r)||e}),e}function z(e,t,o){const r=function(a){return a.match(/\w\w/g).map(function(n){return parseInt(n,16)})},s=function(a){return"#"+a.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},f=r(e),h=r(t),u=f.map(function(a,n){return Math.round(a+(h[n]-a)*o)});return s(u)}function A(e){const{message:t}=e;if(!t||(!l.storage.chatInterpolation||l.storage.chatInterpolation<=0)&&l.storage.noMention)return;const o=X.getChannel(t.channelId);if(!o?.guild_id)return;const r=function(u){if(u.type!="mention"||!u.userId)return;const a=O.getMember(o.guild_id,u.userId)?.colorString;if(!a)return;const n=parseInt(a.slice(1),16);return{...u,roleColor:n,color:n,colorString:a}},s=W(Y.theme,S.semanticColors.TEXT_NORMAL),f=function(u,a,n){let[y]=a,i=n?.map(function(N){return N.type});if(i?.includes("mention")||i?.includes("channelMention")||i?.includes("roleMention")||i?.includes("commandMention")||i?.includes("link")||u.type!="text")return;const d=O.getMember(t.guildId,y);if(!(!d||!d.colorString))return{content:[u],target:"usernameOnClick",context:{username:1,usernameOnClick:{action:"0",userId:"0",linkColor:m.ReactNative.processColor(z(s,d.colorString,l.storage.chatInterpolation/100)),messageChannelId:"0"},medium:!0},type:"link"}};let h=[];l.storage.chatInterpolation>0&&h.push(f),l.storage.noMention||(h.push(r),t.shouldShowRoleOnName=!0,t.referencedMessage?.message&&(t.referencedMessage.message.shouldShowRoleOnName=!0)),t.content&&R({content:t.content},h,[t.authorId]),t.embeds&&t.embeds.forEach(function(u){return R({content:u.description},h,[t.authorId])}),t.referencedMessage?.message?.content&&R({content:t.referencedMessage.message.content},h,[t.referencedMessage.message.authorId])}const{NativeModules:J}=m.ReactNative,{DCDChatManager:q,InfoDictionaryManager:Q,RTNClientInfoManager:Z}=J,ee=Q??Z;function te(){return parseInt(ee.Build)>200013?g.before("updateRows",q,function(e){var t=JSON.parse(e[1]);for(const o of t)A(o);e[1]=JSON.stringify(t)}):g.after("generate",K.prototype,function(e,t){A(t)})}const ne=c.findByStoreName("ThemeStore"),oe=c.find(function(e){return e.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??c.find(function(e){return e.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){};function re(){return g.after("default",c.findByName("VoiceUserConnected",!1),function(e,t){let[o]=e;if(!l.storage.noVoice)try{let r=t.type.prototype?["render",t.type.prototype]:["type",t.type];const s=g.after(r[0],r[1],function(f,h){s();let u=h.props?.children?.[1]?.props;u&&(u.style.color=o?.member?.colorString||oe(ne.theme,S.semanticColors.CHANNELS_DEFAULT))})}catch{}})}const{View:ae}=m.ReactNative,ie=c.findByStoreName("GuildStore");function ce(){return g.after("render",ae,function(e,t){if(l.storage.noRole)return;const o=L.findInReactTree(t,function(s){return s?.props?.roleId});if(!o||isNaN(o.props.roleId)||o.props.excludedApplications||o.props.hasOwnProperty("displayRoleIcon")||o.props.hasOwnProperty("searchable"))return;let r={type:Object.assign({},o.type)};g.after("type",r.type,function(s,f){let h={type:Object.assign({},f.props.children[1].type)};g.after("render",h.type,function(u,a){let n=ie.getGuild(o.props.guildId)?.roles?.[o.props.roleId];n?.colorString&&a.props.style.push({color:n.colorString})}),f.props.children[1].type=h.type}),o.type=r.type})}const{StyleSheet:le,PanResponder:se}=m.ReactNative,M=c.findByStoreName("ThemeStore"),w=c.find(function(e){return e.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??c.find(function(e){return e.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},{View:T}=b.General,{useState:ue,useRef:de}=m.React,_={sliderOff:w(M.theme,S.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:w(M.theme,S.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:w(M.theme,S.semanticColors.MENTION_FOREGROUND)},fe=function(e){let{onSlide:t,value:o}=e;const r=o||0,[s,f]=ue(0),h=de(null);function u(i){h.current&&h.current.measure(function(d,N,B,P,x,Ne){let Ce=(i-x)/(B-x)*100;const Ie=Math.min(Math.max(0,Ce),100);t&&t(Ie)})}const a=m.React.useRef(se.create({onStartShouldSetPanResponder:function(i,d){return!0},onStartShouldSetPanResponderCapture:function(i,d){return!0},onMoveShouldSetPanResponder:function(i,d){return!0},onMoveShouldSetPanResponderCapture:function(i,d){return!0},onPanResponderGrant:function(i,d){u(d.x0)},onPanResponderMove:function(i,d){u(d.moveX)},onPanResponderTerminationRequest:function(i,d){return!0},onPanResponderRelease:function(i,d){},onPanResponderTerminate:function(i,d){},onShouldBlockNativeResponder:function(i,d){return!0}})).current;function n(i){f(i.nativeEvent.layout.width)}const y=le.create({container:{marginLeft:"5%",width:"90%",height:20,borderRadius:25,backgroundColor:_.sliderOff,marginBottom:25},slid:{width:r+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:r===100?25:0,backgroundColor:_.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(s/2),borderRadius:100,backgroundColor:_.thumb}});return m.React.createElement(T,{style:y.container,...a.panHandlers,ref:h},m.React.createElement(T,{style:y.slid},m.React.createElement(T,{style:y.thumb,onLayout:n})))},{Text:he,View:me}=b.General,pe=c.findByStoreName("ThemeStore"),ge=c.find(function(e){return e.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??c.find(function(e){return e.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},C={Typing:v.getAssetIDByName("ic_messages"),Mention:v.getAssetIDByName("ic_mention_user"),Text:v.getAssetIDByName("ic_add_text"),Voice:v.getAssetIDByName("ic_voice_channel_24px"),Role:v.getAssetIDByName("ic_person_shield")},ye={text:ge(pe.theme,S.semanticColors.TEXT_NORMAL)};function Se(e,t,o){const r=function(a){return a.match(/\w\w/g).map(function(n){return parseInt(n,16)})},s=function(a){return"#"+a.map(function(n){return n.toString(16).padStart(2,"0")}).join("")},f=r(e),h=r(t),u=f.map(function(a,n){return Math.round(a+(h[n]-a)*o)});return s(u)}function Re(){var e;return $.useProxy(l.storage),(e=l.storage).chatInterpolation??(e.chatInterpolation=0),React.createElement(m.ReactNative.ScrollView,{style:{flex:1}},React.createElement(p.FormSection,{title:"Where to show the top role color?",titleStyleType:"no_border"},React.createElement(p.FormSwitchRow,{label:"Show in typing",subLabel:"Display the top role color in the typing bar.",leading:React.createElement(p.FormIcon,{source:C.Typing}),value:!l.storage.hideTyping,onValueChange:function(t){return l.storage.hideTyping=!t}}),React.createElement(p.FormSwitchRow,{label:"Show in mentions",subLabel:"Display the top role color in mentions in the chat.",leading:React.createElement(p.FormIcon,{source:C.Mention}),value:!l.storage.noMention,onValueChange:function(t){return l.storage.noMention=!t}}),React.createElement(p.FormSwitchRow,{label:"Show in member list",subLabel:"Display the top role color in the member list role section headers.",leading:React.createElement(p.FormIcon,{source:C.Role}),value:!l.storage.noRole,onValueChange:function(t){return l.storage.noRole=!t}}),React.createElement(me,{style:{marginHorizontal:10,marginBottom:2}},React.createElement(b.HelpMessage,{messageType:0},"(Regarding option below) - Limitations cause text coloring to prevent interaction with the text. Instead, you'll have to press anywhere else in the message to open the context menu or use gestures.")),React.createElement(p.FormSwitchRow,{label:"Show in chat text",subLabel:"Display the top role color in the chat text... Why would you want this?",leading:React.createElement(p.FormIcon,{source:C.Text}),value:l.storage.chatInterpolation>0,onValueChange:function(t){l.storage.chatInterpolation=t?100:0}}),React.createElement(he,{style:{marginLeft:"5%",color:Se(ye.text,"#ff0000",l.storage.chatInterpolation/100),fontFamily:m.constants.Fonts.DISPLAY_MEDIUM,fontSize:16,marginBottom:5,marginTop:-5}},"Color interpolation (for chat text):"),React.createElement(fe,{onSlide:function(t){l.storage.chatInterpolation=t},value:l.storage.chatInterpolation,style:{marginBottom:0}}),React.createElement(p.FormSwitchRow,{label:"Show in voice channel member list",subLabel:"Display the top role color in the voice channel member list.",leading:React.createElement(p.FormIcon,{source:C.Voice}),value:!l.storage.noVoice,onValueChange:function(t){l.storage.noVoice=!t}})))}let I=[];var ve={onLoad:function(){I.push(j()),I.push(te()),I.push(re()),I.push(ce())},onUnload:function(){for(const e of I)e()},settings:Re};return E.default=ve,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.metro.common,vendetta.patcher,vendetta.metro,vendetta.ui.components,vendetta.ui,vendetta.plugin,vendetta.utils,vendetta.ui.components.Forms,vendetta.storage,vendetta.ui.assets);
